---
title: "Tvyal Newsletter"
author: "Aghasi Tavadyan"
date: "2023-12-25"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(scales)
library(gganimate)
library(transformr)

rm(list = ls()); gc()

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
```

**’Ä’°÷Ä’£’•’¨’´ ’£’∏÷Ä’Æ’®’∂’Ø’•÷Ä,**

## **’á’∂’∏÷Ä’∞’°’æ’∏÷Ä ‘±’¥’°’∂’∏÷Ä ÷á ’ç’∏÷Ç÷Ä’¢ ‘æ’∂’∏÷Ç’∂’§**

üéÑüéÖüéÅ‚ú®üîîüïØÔ∏èü¶åüéâüç™ü•õ‚õÑüå®Ô∏èüß§üß£üç¨üç≠

’á’∂’∏÷Ä’∞’°’Ø’°’¨ ’•’¥ ’∏÷Ä ’∞’•’ø÷á’∏÷Ç’¥ ’•÷Ñ ’¥’•÷Ä ’£’∏÷Ä’Æ’∏÷Ç’∂’•’∏÷Ç’©’µ’°’∂’®÷â

Thanks for your time and for hanging with us.

[![](christmas_tree_animation.gif)](https://forms.gle/C7ouBuBafxquDiRN9)

## ‘±’¥÷É’∏÷É’•’∂÷Ñ ’ø’°÷Ä’´’∂

* ’£÷Ä’•’©’• ’Ø’•’Ω ’ø’°÷Ä’´’ù 25 ’∑’°’¢’°’©, 25 ’æ’•÷Ä’¨’∏÷Ç’Æ’∏÷Ç’©’µ’∏÷Ç’∂ ‚è≥
* ’°’æ’•’¨’´ ÷Ñ’°’∂ 10 ’∞’°’¶’°÷Ä ’ø’∏’≤ ’Ø’∏’§ üíª
* ’°’æ’•’¨’´ ÷Ñ’°’∂ 50 ’£’Æ’°’∫’°’ø’Ø’•÷Ä üìä
* 930 ’ß’¨ ÷É’∏’Ω’ø ’¢’°’™’°’∂’∏÷Ä’§’°’£÷Ä’æ’°’Æ’∂’•÷Ä’´ ÷Å’°’∂’Ø’∏÷Ç’¥ üì¨

## Let's summarize the year

* Almost half a year: 25 weeks, 25 analyses ‚è≥
* More than 10 thousand lines of code üíª
* More than 50 plots üìä
* 930 subscribed emails üì¨


## ‘Ω’∂’§÷Ä’∏÷Ç’¥ ’•’¥ ’£’∂’°’∞’°’ø’•÷Ñ ’¥’•÷Ä ’£’∏÷Ä’Æ’∏÷Ç’∂’•’∏÷Ç’©’µ’∏÷Ç’∂’®

## Please rate our work

[’Ä’°÷Ä÷Å’∏÷Ç’¥’® ’Ø’°÷Ä’≥ ’ß:](https://forms.gle/C7ouBuBafxquDiRN9)

[![](pictures/rate_us.png)](https://forms.gle/C7ouBuBafxquDiRN9)

’Ä’°’ª’∏÷Ä’§ ’∑’°’¢’°’© ’∂’µ’∏÷Ç’¶’¨’•’©’•÷Ä ’π’´ ’¨’´’∂’´÷â ‘ø’∞’°’∂’§’´’∫’•’∂÷Ñ ’∞’°’ª’∏÷Ä’§ ’ø’°÷Ä’´÷â ‘≤’°÷Ä’´ ’∞’°’∂’£’Ω’ø’µ’°’∂ ÷Ö÷Ä’•÷Ä÷â


## ‘∂‘º’Ñ ’∞’°’≤’∏÷Ä’§’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä

[‘¥’´’ø’•÷Ñ ’Ü’æ’•÷Ä ’Ñ’∂’°÷Å’°’Ø’°’∂’µ’°’∂’´’∂ ’ø’æ’°’Æ ’´’¥ ’æ’•÷Ä’ª’´’∂ ’∞’°÷Ä÷Å’°’¶÷Ä’∏÷Ç’µ÷Å’®, ’∏÷Ä’ø’•’≤ ’°’¥÷É’∏÷É’∏÷Ç’¥ ’•’¥ 2023-’®÷â](https://www.youtube.com/watch?v=YbMAqFJkfeU)

’Ä’°÷Ä÷Å’°’¶÷Ä’∏÷Ç’µ÷Å’∏÷Ç’¥ ’∑’∏’∑’°÷É’æ’•’¨ ’•’∂ ’∞’•’ø÷á’µ’°’¨ ’©’•’¥’°’∂’•÷Ä’®÷â

* ‘ª’∂’π’∏’û÷Ç 2023 ’©’æ’°’Ø’°’∂’´’∂ ’Ä’°’µ’°’Ω’ø’°’∂’∏÷Ç’¥ 242 ’¥’¨÷Ä’§ ’§÷Ä’°’¥’∏’æ ’°’æ’•’¨ ’∞’°÷Ä’Ø ’ß ’∞’°’æ’°÷Ñ’æ’•’¨÷â
* ’Ä’°’µ’°’Ω’ø’°’∂’´ ’ø’∂’ø’•’Ω’∏÷Ç’©’µ’∏÷Ç’∂’∂ ’°’≥’•’¨ ’ß 7 ’ø’∏’Ø’∏’Ω’∏’æ’ù ’¶’¢’∏’Ω’°’∑÷Ä’ª’∏÷Ç’©’µ’∏÷Ç’∂ ÷á ’è’è ’¨’∏’Ø’∏’¥’∏’ø’´’æ’∂’•÷Ä÷â
* ’á’´’∂’°÷Ä’°÷Ä’∂’•÷Ä’® ’å’∏÷Ç’Ω’°’Ω’ø’°’∂’´÷Å ’æ’•÷Ä’°’§’°’º’∂’∏÷Ç’¥ ’•’∂ ’Ä’°’µ’°’Ω’ø’°’∂. ’§÷Ä’°’¥’∂ ’°’¥÷Ä’°’∫’∂’§’æ’∏÷Ç’¥ ’ß ’º’∏÷Ç’¢’¨’∏÷Ç ’∂’Ø’°’ø’¥’°’¥’¢÷â

<a href="https://www.youtube.com/watch?v=YbMAqFJkfeU">
  <img src="https://i3.ytimg.com/vi/YbMAqFJkfeU/hqdefault.jpg" alt="YouTube Video" style="width:60%;">
</a>



## The Christmas Tree code

’Å’•’¶ ’∏÷Ç’≤’°÷Ä’Ø’æ’∏’≤ ’¢’∏’¨’∏÷Ä ’æ’•÷Ä’¨’∏÷Ç’Æ’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä’® ’∫’°’ø÷Ä’°’Ω’ø’æ’•’¨ ’•’∂ ’Ø’∏’§’´ ’¥’´’ª’∏÷Å’∏’æ` ’∞’´’¥’∂’°’Ø’°’∂’∏÷Ç’¥ R ÷á markdown ’Æ÷Ä’°’£÷Ä’°’æ’∏÷Ä’¥’°’∂ ’¨’•’≤’æ’∏’æ÷â ’ï÷Ü’´’Ω’°’µ’´’∂ ’Æ÷Ä’°’£÷Ä’•÷Ä ’π’•’∂ ÷Ö’£’ø’°’£’∏÷Ä’Æ’æ’•’¨ ’∞’•’ø’°’¶’∏’ø’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä’´ ’´÷Ä’°’Ø’°’∂÷Å’¥’°’∂ ’¥’•’ª÷â ‘≤’∏’¨’∏÷Ä ’æ’•÷Ä’¨’∏÷Ç’Æ’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä’® ’°’º’Ø’° ’•’∂ ’∂’°÷á [’¥’•÷Ä ’Ø’°’µ÷Ñ’ß’ª’∏÷Ç’¥](https://www.tvyal.com/newsletter), ’¢’∏’¨’∏÷Ä ’æ’•÷Ä’¨’∏÷Ç’Æ’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä’´ ’Ø’∏’§’® ÷á ’ø’æ’µ’°’¨’∂’•÷Ä’® ’§÷Ä’æ’°’Æ ’•’∂ [Github-’∏÷Ç’¥](https://github.com/tavad/tvyal_newsletter)÷â

üéÑ ‘±’µ’Ω÷Ö÷Ä ’°’º’°’ª’´’∂ ’°’∂’£’°’¥ ’∏÷Ä’∏’∑’•÷Å’´ ’±’•÷Ä ’∞’•’ø ’Ø’´’Ω’æ’•’¨ ’∂’°÷á ’Ø’∏’§’∏’æ÷â ‘±’µ’Ω ’∫’°÷Ä’°’£’°’µ’∏÷Ç’¥ ’ø’∏’∂’°’Æ’°’º’´ ’£’Æ’°’£÷Ä’¥’°’∂ ’Ø’∏’§’∏’æ÷â üéÑ

’ë’°’∂’Ø’°’∂’∏÷Ç’¥ ’•’¥ **’∏’£’•’∑’∂’π’æ’•÷Ñ ’∏÷Ç ’∏’£’•’∑’∂’π’•÷Ñ** ’•’Ø’∏’≤ ’ø’°÷Ä’´÷â

-------------

The main colors of the Christmas Three and the main parameter `scale_factor`, which desides the hight of the three and ajast everything acordingly.

```{r setting the main colors}

# Change to adjust the tree height. Provide an odd number to works properly
scale_factor = 15

# defining the colors
tree_colors = c(
  "#A8D185", "#04905E", "#9acd32", "#3D9618", "#8AD378", "#3FD485",
  "#089E79", "#079094", "#2F9B61", "#50C878", "#008000", "#008000"
)

bauble_colours = c(
  "#646F75", "#949399", "#8C9EAA", "#C3C4C6",
  "#9CC6D4", "#CD936D", "#DB7076", "#E04C52"
)

garland_reds <- c(
  "#ff0000", "#ffa07a", "#fa8072", "#ff6347",
  "#cd5c5c", "#ff4500", "#dc143c", "#b22222"
)

green_shades <- 
  tibble(
    x = seq(0, scale_factor, by = 1),
    y = scale_factor/2 + 1,
    fill = colorRampPalette(c("#013220", "darkgreen"))(scale_factor + 1)
  )
 
set.seed(1234)
```

Constructing the Christmas Tree toys (bubbles) database and ploting it.

```{r tree bubbles}
# Christmas tree bubbles database
bubbles <- 
  crossing(
    x = 1:(scale_factor*2),
    y = 1:scale_factor
  ) |> 
  filter(
    x %% 2 != y %% 2,
    y <= x,
    y <= -x + max(x)
  ) %>%
  mutate(
    x = x / 2,
    shp = sample(1:6, nrow(.), replace = T),
    sz = sample(seq(0.5, 1, by=0.1), nrow(.), replace = T),
    color = sample(bauble_colours, nrow(.), replace = T),
  )

# Let's see the bubbles in a plot
bubbles |> 
  ggplot(aes(x = x, y = y + 0.4, shape = factor(shp), size=sz, color = I(color))) +
  geom_point() +
  scale_shape_manual(values = c(20:24,8))
```

Constructing the three database with geometric scales and the tree topper. Below is the plot of Christmas three scales. Here the heavy lifting does the x^2 + y^2 = 1 circle equation: `y_prime = sqrt(1 - x_prime^2)`.

```{r tree and the treetopper database}

main_shape_contour <- function(tbl) {
  tbl <- 
    tbl |> 
    mutate(
      y_prime = sqrt(1 - x_prime^2),
      y_prime2 = ifelse(x_prime >= 0, x_prime - 1, x_prime + 1),
      y_prime2 = sqrt(1 - (y_prime2)^2)-1,
      x_prime = x_prime + x,
      y_prime = y_prime + y,
      y_prime2 = y_prime2 + y,
      x_prime = x_prime / 2,
      x = x / 2,
    ) |> 
    pivot_longer(contains("y_prime"), values_to = "y_prime") |> 
    filter(y_prime >= 1)
  
  return(tbl)
}

main_tree <- 
  crossing(
    x = 1:(scale_factor*2),
    y = 1:scale_factor,
    x_prime = seq(-1, 1 , 0.01)
  ) |> 
  filter(
    x %% 2 != y %% 2,
    y <= x,
    y <= -x + max(x)
  ) %>%
  mutate(
      color = sample(tree_colors, nrow(.), replace = TRUE)
  ) %>% 
  main_shape_contour()

treetopper_data <- 
  tibble(
    x = scale_factor, 
    y = scale_factor + 1,   
    x_prime = seq(-1, 1 , 0.01)
  ) |> 
  main_shape_contour() |> 
  crossing(
    nesting(
      linetype = as.factor(1:7), 
      color = sample(garland_reds, 7)
    )
  )

# Let's see the tree in a plot
main_tree |> 
  ggplot(aes(x_prime, y_prime, group = paste(x, y))) +
  geom_polygon(aes(fill = I(color), color = I(color))) 

```

This function was the hardest. It randomly constructs a garland line that mimics the scales of the Tree.

```{r adding the garland}

# This function plots a random gerland based on the geometry of the tree
garland <-
  function(len = scale_factor * 2, resalution = 500) {
    j = NULL
    j[1] = 0
    
    for (i in 1:len) {
      # j[i + 1] = cumsum(j)
      if ((i + sum(j)) %% 2 == 0) {
        j[i + 1] = sample(c(0, 1), size = 1)
      } else{
        j[i + 1] = sample(c(0, -1), size = 1) 
      }
    }
    
    j = tail(j, -1)
    
    data <- 
      tibble(
        x_floor = 1:len,
        y_floor = cumsum(j)
      ) |> 
      crossing(x = seq(0, 1 - 1/resalution, 1/resalution)) |> 
      mutate(
        x = x_floor + x,
        y = case_when(
          (x_floor + y_floor) %% 2 == 0 ~ sqrt(1 - (x %% x_floor)^2),
          (x_floor + y_floor) %% 2 == 1 ~ sqrt(1 - (x %% x_floor - 1)^2),
        ),
        y = y + y_floor
      ) |> 
      select(x,y)
    
    return(data)
  }

# An exsample of a random garland
garland() |> 
  ggplot(aes(x,y)) +
  geom_line()
```

This functin just multiples the said random garland to be drown all over the Three.

```{r multiplaying the garland to rap up it across the tree}
garland_multiplayer <-
  function() {
  
    garland(resalution = 70) |> 
      crossing(
        nesting(
          linetype = as.factor(1:7), 
          color = sample(garland_reds, 7)
        ),
        nesting(
          hight = seq(-scale_factor, scale_factor * 2, 2),
        )
      ) |> 
      arrange(hight) |> 
      mutate(
        y = y + hight
      ) |> 
      filter(
        y > 1,
        floor(y) <= floor(x),
        floor(y) <= -floor(x) + max(x) - 1
      ) |> 
      mutate(x = x /2)
  }

# let's see multiplied garlands
garland_multiplayer() |> 
  filter(linetype == "1") |> 
  ggplot(aes(x, y, color = I(color), group = hight)) +
  geom_line()
```

Finialy. Combining everything and animating.

```{r combining everything together}
# Combine everything together in a animation

christmas_tree_animation <- 
  main_tree |> 
  ggplot(aes(x_prime, y_prime, group = paste(x, y))) +
  geom_tile(
    data = green_shades, 
    aes(x, y, width = 1, height = scale_factor * 1.266667, fill = I(fill))
  ) +
  geom_tile(aes(x = scale_factor/2, y = 0, width = 2, height = 2), fill = "#b22222") +
  geom_polygon(aes(fill = I(color), color = I(color))) +
  geom_point(
    data = bubbles, 
    aes(x = x, y = y + 0.4, shape = factor(shp), size=sz, color = I(color)), 
    show.legend = F
  ) +
  geom_line(
    data = garland_multiplayer(),
    aes(
      x, y, 
      linetype = as.factor(linetype),
      group = hight, color = I(color)
    ),
    linewidth = 1.8
  ) +
  geom_line(
    data = treetopper_data,
    aes(
      x_prime, y_prime, 
      linetype = as.factor(linetype),
      group = paste(x, y), color = I(color)
    ),
    linewidth = 1
  ) +
  labs(
    title = "Merry Christmas & Happy New Year",
    subtitle = NULL,
    caption = "tvyal.com"
  ) +
  scale_shape_manual(values = c(20:24,8)) +
  theme_void() + 
  coord_fixed() +
  theme(
    legend.position = "drop",
    plot.background = element_rect(fill="#013220"), 
    title = element_text(colour="white"),
    plot.title = element_text(
      size = 30, hjust = 0.5,
      margin = margin(t = 30, unit = "pt")
    ),
    plot.caption = element_text(
      size = 14, hjust = 0.5, 
      margin = margin(b = 12, unit = "pt")
    )
  ) +
  transition_states(linetype, transition_length = 2, state_length = 1) +
  enter_fade() +
  exit_fade()
```

Rendering and saving the animation.

```{r rendering and saving the animation, eval=FALSE}

animate(
  christmas_tree_animation,
  nframes = 26,
  width = 600,
  height = 806
)

gganimate::anim_save("christmas_tree_animation.gif")
```


**The end result:**

[![](christmas_tree_animation.gif)](https://forms.gle/uwSiJNazakfP2EGj7)


---
               

‘µ’©’• ’∞’∂’°÷Ä’°’æ’∏÷Ä ’ß, ’≠’∂’§÷Ä’∏÷Ç’¥ ’•’¥ ’°’µ’Ω ’∂’µ’∏÷Ç’©’® ’∏÷Ç’≤’°÷Ä’Ø’•’¨ ’∂’°÷á ’°’µ’∂ ’¥’°÷Ä’§’Ø’°’∂÷Å, ’∏÷Ç’¥ ’°’µ’∂ ’Ø’°÷Ä’Æ’∏÷Ç’¥ ’•÷Ñ ’Ø’°÷Ä’∏’≤ ’ß ’∞’•’ø’°÷Ñ÷Ä÷Ñ÷Ä’•’¨:

’ç’∫’°’Ω’•÷Ñ ’∞’°’ª’∏÷Ä’§ ’∞’°’≤’∏÷Ä’§’°’£÷Ä’∏÷Ç’©’µ’°’∂’® ’¥’´ ’∑’°’¢’°’©’æ’° ’®’∂’©’°÷Å÷Ñ’∏÷Ç’¥:        


’Ä’°÷Ä’£’°’∂÷Ñ’∂’•÷Ä’∏’æ,            
‘±’≤’°’Ω’´ ‘π’°’æ’°’§’µ’°’∂         
25.12.2023          
[tvyal.com](https://www.tvyal.com/)      
[tavadyan.com](https://www.tavadyan.com/)

---

[Was this email forwarded to you? Subscribe here.](https://www.tvyal.com/subscribe)

[‘≤’°’™’°’∂’∏÷Ä’§’°’£÷Ä’æ’•÷Ñ](https://www.tvyal.com/subscribe)

       
---              
               


####### **’à÷Ç’∑’°’§÷Ä’∏÷Ç’©’µ’∏÷Ç’∂. ’Å’•÷Ä ’ß’¨.÷É’∏’Ω’ø’® ’¥’•’µ’¨’´’Ω’©’´ ’¥’•’ª ’ß, ’∏÷Ä’´ ’¥’´’ª’∏÷Å’∏’æ ’•’Ω ’Ø’´’Ω’æ’∏÷Ç’¥ ’•’¥ ’∑’°’¢’°’©’°’Ø’°’∂ ’∂’µ’∏÷Ç’©’•÷Ä, ’∏÷Ä’∏’∂÷Ñ ’∞’´’¥’∂’°’Ø’°’∂’∏÷Ç’¥ ’∂’•÷Ä’Ø’°’µ’°÷Å’∂’∏÷Ç’¥ ’•’∂ ’Ä’°’µ’°’Ω’ø’°’∂’´ ’ø’∂’ø’•’Ω’∏÷Ç’©’µ’°’∂’®: ’Ü’µ’∏÷Ç’©’•÷Ä’® ’∂’•÷Ä’°’º’∏÷Ç’¥ ’•’∂ ’£’Æ’°’∫’°’ø’Ø’•÷Ä’∂’•÷Ä, [’ø’æ’µ’°’¨’∂’•÷Ä’´ ’¢’°’¶’°’∂’•÷Ä](https://github.com/tavad/tvyal_newsletter), ’ø’•’Ω’°’∂’µ’∏÷Ç’©’•÷Ä, ’∞’∏’§’æ’°’Æ’∂’•÷Ä, [’°’º÷Å’°’∂÷Å ’æ’°’∞’°’∂’°’Ø’∂’•÷Ä](https://www.tvyal.com/projects), ’ø’∂’ø’•’Ω’°’Ø’°’∂ ’£’∏÷Ä’Æ’´÷Ñ’∂’•÷Ä, ’Ø’°’∂’≠’°’ø’•’Ω’∏÷Ç’¥’∂’•÷Ä ÷á ’∞’°’∑’æ’•’ø’æ’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä: ‘µ’©’• ÷Å’°’∂’Ø’°’∂’∏÷Ç’¥ ’•÷Ñ ’π’•’≤’°÷Ä’Ø’•’¨ ’¢’°’™’°’∂’∏÷Ä’§’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂’®, ’≠’∂’§÷Ä’∏÷Ç’¥ ’•’¥ ’ø’•’≤’•’Ø’°÷Å÷Ä’•÷Ñ ’´’∂’±, ÷á ’•’Ω ’Ø’∞’•’º’°÷Å’∂’•’¥ ’±’•÷Ä ’ß’¨. ÷É’∏’Ω’ø’® ÷Å’∏÷Ç÷Å’°’Ø’´÷Å: ‘≥÷Ä’•÷Ñ ’∂’°÷á ’•’©’• ’∏÷Ç’∂’•÷Ñ ’¥’•’∂’Ø’∂’°’¢’°’∂’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä:**

####### **Important! Your email is part of the mailing list where I share weekly materials primarily focused on the Armenian economy. These materials encompass charts, [databases](https://github.com/tavad/tvyal_newsletter), videos, articles, [online dashboards](https://www.tvyal.com/projects), economic tools, forecasts, and reports. If you wish to unsubscribe, please let me know, and I will remove your email from the list. Please share your comments as well‚Ä§**







