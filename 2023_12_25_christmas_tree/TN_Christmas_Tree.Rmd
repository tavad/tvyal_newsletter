---
title: "Tvyal Newsletter"
author: "Aghasi Tavadyan"
date: "2023-12-18"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(rvest)
library(RcppRoll)
library(scales)
library(readxl)

rm(list = ls()); gc()

theme_tvyal <- function(base_size = 12, base_family = "sans") 
{
  colors <- deframe(ggthemes::ggthemes_data[["fivethirtyeight"]])
  (ggthemes::theme_foundation(
    base_size = base_size, base_family = base_family) + 
      theme(
        line = element_line(colour = "black"), 
        rect = element_rect(fill = "white", linetype = 0, colour = NA),
        text = element_text(colour = colors["Dark Gray"]), 
        # axis.title = element_blank(),
        # axis.text = element_text(), 
        axis.ticks = element_blank(),
        axis.line = element_blank(), 
        legend.background = element_rect(), 
        legend.position = "bottom", 
        legend.direction = "horizontal", 
        legend.box = "vertical", 
        panel.grid = element_line(colour = NULL), 
        panel.grid.major = element_line(colour = colors["Medium Gray"]), 
        panel.grid.minor = element_blank(), 
        plot.title = element_text(hjust = 0, size = rel(1.5), face = "bold"),
        plot.margin = unit(c(1, 1, 1, 1), "lines"), strip.background = element_rect()
      )
  )
}

theme_set(theme_tvyal())

save_last_plot <- 
  function(filename, extension = "png", width = 1344, height = 756) {
    
    filename <- str_replace_all(filename, " ", "_")
    last_plot <- recordPlot()
    
    if (extension == "png") {
      png(paste0(filename, ".", extension), width = width, height = height)
    } else if (extension == "pdf") {
      pdf(paste0(filename, ".", extension), width = width, height = height)
    } else {
      stop("Unsupported file extension. Use 'png' or 'pdf'.")
    }
    
    replayPlot(last_plot)
    dev.off()
    paste0(filename, ".", extension)
  }

new_palette_colors <- c(
  "#003f5c", "#2f4b7c", "#665191", "#a05195", 
  "#d45087", "#f95d6a", "#ff7c43", "#ffa600"
)
update_geom_defaults("rect", list(fill  = new_palette_colors[1], alpha = 0.8)) 
update_geom_defaults("line", list(color = new_palette_colors[1], alpha = 0.8))
update_geom_defaults("area", list(fill  = new_palette_colors[1], alpha = 0.8))

caption_arm <-  "Հեղինակ` Աղասի Թավադյան   |   tvyal.com   |   tavadyan.com"
caption_eng <-  "Author: Aghasi Tavadyan   |   tvyal.com   |   tavadyan.com"

doParallel::registerDoParallel(cores = 8)

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
```




***English summary below.***

Հարգելի գործընկեր,

Հուսով եմ լավ եք:
Ներկայացնում եմ անցած շաբաթվա վերլուծությունները և աշխատանքները.

1. Գյուղատնտեսությունից արդյունաբերություն անցումը
2. Սխալների ուղղում
3. ԶԼՄ հաղորդագրություններ
4. English summary
5. Նվեր Ամանորի նախօրեին / A little gift before Christmas


[![](christmas_tree_animation.gif)](https://forms.gle/uwSiJNazakfP2EGj7)


## 1. Գյուղատնտեսությունից արդյունաբերություն անցումը

### Կամ գյուղատնտեսությունը կոլապսի է ենթարվել



## 2. Սխալների ուղղում




## 3. ԶԼՄ հաղորդագրություններ

[Դիտեք իմ վերջին հարցազրույցը, որտեղ ամփոփում եմ 2023 թվականը։](https://www.youtube.com/watch?v=YbMAqFJkfeU)

Հարցազրույցում շոշափվել են հետևյալ թեմաները։

* Ինչո՞ւ 2023 թվականին Հայաստանում 242 մլրդ դրամով ավել հարկ է հավաքվել։
* Հայաստանի տնտեսությունն աճել է 7 տոկոսով՝ զբոսաշրջություն և ՏՏ լոկոմոտիվներ։
* Շինարարները Ռուսաստանից վերադառնում են Հայաստան. դրամն ամրապնդվում է ռուբլու նկատմամբ։

<a href="https://www.youtube.com/watch?v=YbMAqFJkfeU">
  <img src="https://i3.ytimg.com/vi/YbMAqFJkfeU/hqdefault.jpg" alt="YouTube Video" style="width:60%;">
</a>



## 4. English Summary

**The **





```{r}
scale_factor = 15 # this is to determine Christmas Tree size.

three_colors = c("#A8D185", "#04905E", "#9acd32",
                 "#3D9618", "#8AD378", "#3FD485", "#089E79",
                 "#079094", "#2F9B61", "#50C878", "#008000", "#008000")


bauble_colours = c(
"#646F75", "#949399", "#8C9EAA", "#C3C4C6", "#9CC6D4", "#7FA490", "#CD936D", "#DB7076", "#E04C52")


 reds <- c("#ff0000", "#ffa07a", "#f08080", "#fa8072", "#e9967a",
    "#ff6347", "#cd5c5c", "#ff4500", "#dc143c", "#b22222")
 
set.seed(1234)

bubbles <- 
  crossing(
    x = 1:(scale_factor*2),
    y = 1:scale_factor
  ) |> 
  filter(
    x %% 2 != y %% 2,
    y <= x,
    y <= -x + max(x)
  ) %>%
  mutate(
    x = x / 2,
    shp = sample(1:7, nrow(.), replace = T),
    sz = sample(seq(.5,1,by=.1), nrow(.), replace = T),
    col1 = sample(bauble_colours, nrow(.), replace = T),
  )

main_shape_contour <- function(tbl) {
  tbl <- 
    tbl |> 
    mutate(
      y_prime = sqrt(1 - x_prime^2),
      y_prime2 = ifelse(x_prime >= 0, x_prime - 1, x_prime + 1),
      y_prime2 = sqrt(1 - (y_prime2)^2)-1,
      x_prime = x_prime + x,
      y_prime = y_prime + y,
      y_prime2 = y_prime2 + y,
      x_prime = x_prime / 2,
      x = x / 2,
      # nrow = nrow(x = _),
    ) |> 
    pivot_longer(contains("y_prime"), values_to = "y_prime") |> 
    filter(y_prime >= 1)
  
  return(tbl)
}

main_tree <- 
  crossing(
  x = 1:(scale_factor*2),
  y = 1:scale_factor,
  x_prime = seq(-1, 1 , 0.01)
) |> 
  filter(
    x %% 2 != y %% 2,
    y <= x,
    y <= -x + max(x)
  ) %>%
  mutate(
      col1 = sample(colors_three, nrow(.), replace = TRUE)
  ) %>% 
  main_shape_contour()

treetopper_data <- 
  tibble(
    x = scale_factor, 
    y = scale_factor + 1,   
    x_prime = seq(-1, 1 , 0.01)
  ) |> 
  main_shape_contour() |> 
  crossing(
    nesting(
      linetype = paste0("count", 1:8), 
      color = sample(reds, 8)
    )
  )





garland <-
  function(len = 30, resalution = 500) {
    j = NULL
    j[1] = 0
    
    for (i in 1:len) {
      # j[i + 1] = cumsum(j)
      if ((i + sum(j)) %% 2 == 0) {
        j[i + 1] = sample(c(0, 1), size = 1)
      } else{
        j[i + 1] = sample(c(0, -1), size = 1) 
      }
    }
    
    j = tail(j, -1)
    
    data <- 
      tibble(
        x_floor = 1:len,
        y_floor = cumsum(j)
      ) |> 
      crossing(x = seq(0, 1 - 1/resalution, 1/resalution)) |> 
      mutate(
        x = x_floor + x,
        y = case_when(
          (x_floor + y_floor) %% 2 == 0 ~ sqrt(1 - (x %% x_floor)^2),
          (x_floor + y_floor) %% 2 == 1 ~ sqrt(1 - (x %% x_floor - 1)^2),
        ),
        y = y + y_floor
      ) |> 
      select(x,y)
    
    return(data)
  }



garland_multiplayer <- function(count = 7) {
  
  data <- NULL
  
  for (i in 1:count) {
    data <- 
      garland(resalution = 70) |> 
      mutate(
        group = paste0("count", i), 
        hight = sample(seq(1, 19, 2), 1),
        color = sample(reds, 1)
      ) |> 
      bind_rows(data)
  }
  
  data |> 
    arrange(group) |> 
    mutate(
      y = y + hight
    ) |> 
    filter(
      y >= 1,
      floor(y) <= floor(x),
      floor(y) <= -floor(x) + max(x) - 1
    ) |> 
    mutate(x = x /2)
}


garland_multiplayer <-
  function() {
  
    garland(resalution = 70) |> 
      crossing(
        nesting(
          linetype = paste0("count", 1:8), 
          color = sample(reds, 8)
        ),
        nesting(
          hight = seq(-5, 33, 2),
        )
      ) |> 
      arrange(hight) |> 
      mutate(
        y = y + hight
      ) |> 
      filter(
        y >= 1,
        floor(y) <= floor(x),
        floor(y) <= -floor(x) + max(x) - 1
      ) |> 
      mutate(x = x /2)
  }


garland_multiplayer()

snow <- 
  tibble(
    x = sample(seq(1, max(cone$x)+1, by=.01), 100, replace = F),
    y = sample(seq(1, max(cone$y)+1, by=.01), 100, replace = F)
  ) %>% 
  group_by(x) %>% 
  nest() %>% 
  mutate(
    data =  map(
      data, 
      ~data.frame(
        y=seq(.$y, .$y-sample(seq(.5,1,by=.01),1), length.out = 100)
      ) %>% 
        mutate(time = sample(seq(0.5,.9, .01), 1)) %>% 
        mutate(time = seq(unique(time), unique(time)+.02, length.out = nrow(.)))
    )
  ) %>% 
  unnest() 


green_shades <- tibble(
  x = seq(0, 15, by = 1),
  y = 8.5,
  fill = colorRampPalette(c("#013220", "darkgreen"))(16)
)

library(gganimate)
library(transformr)

christmas_tree_animation <- 
  main_tree |> 
  ggplot(aes(x_prime, y_prime, group = paste(x, y))) +
  geom_tile(
    data = green_shades, 
    aes(x, y, width = 1, height = 19, fill = I(fill))
  ) +
  geom_tile(aes(x = scale_factor/2, y = 0, width = 2, height = 2), fill = "#b22222") +
  geom_polygon(aes(fill = I(col1), color = I(col1))) +
  geom_line(
    data = garland_multiplayer(),
    aes(x, y, linetype = as.factor(linetype), group = hight, color = I(color)),
    size = 1.8
  ) +
  geom_point(
    data = bubbles, 
    aes(x = x, y = y + 0.4, shape = factor(shp), size=sz, color = I(col1)), 
    show.legend = F
  ) +
  geom_line(
    data = treetopper_data,
    aes(x_prime, y_prime, linetype = as.factor(linetype), 
        group = paste(x, y), color = I(color)),
    size = 1
  ) +
  # geom_jitter(data=snow, aes(x,y,group=x), colour="white", shape=8, size=1) +
  scale_shape_manual(values = c(20:25,8)) +
  theme_void() + 
  coord_fixed() +
  theme(
    plot.background = element_rect(fill="#013220"), 
    title = element_text(colour="white"),
    plot.title = element_text(size = 30, hjust = 0.5),
    plot.caption = element_text(size = 14, hjust = 0.5),
    legend.position = "drop"
  ) +
  labs(
    title = "Merry Christmas & Happy New Year",
    caption = "tvyal.com"
  ) +
  transition_states(linetype, transition_length = 2, state_length = 1) +
  # transition_states(color, transition_length = 2, state_length = 1) + 
  enter_fade() +
  exit_fade()

christmas_tree_animation


animate(
  christmas_tree_animation,
  nframes = 16,
  width = 627,
  height = 800
)

gganimate::anim_save("christmas_tree_animation.gif")
```





---

Այս վերլուծությունը առկա է նաև [մեր կայքէջում](https://www.tvyal.com/newsletter/2023_12_18), այս վերլուծության կոդը և տվյալները դրված են նաև [Github-ում](https://github.com/tavad/tvyal_newsletter)։                        
---                  

Եթե հնարավոր է, խնդրում եմ այս նյութը ուղարկել նաև այն մարդկանց, ում այն կարծում եք կարող է հետաքրքրել:

Սպասեք հաջորդ հաղորդագրությանը մի շաբաթվա ընթացքում:        


Հարգանքներով,            
Աղասի Թավադյան         
18.12.2023          
[tvyal.com](https://www.tvyal.com/)      
[tavadyan.com](https://www.tavadyan.com/)

---

[Was this email forwarded to you? Subscribe here.](https://www.tvyal.com/subscribe)

[Բաժանորդագրվեք](https://www.tvyal.com/subscribe)

       
---              
               


####### **Ուշադրություն. Ձեր էլ.փոստը մեյլիսթի մեջ է, որի միջոցով ես կիսվում եմ շաբաթական նյութեր, որոնք հիմնականում ներկայացնում են Հայաստանի տնտեսությանը: Նյութերը ներառում են գծապատկերներ, [տվյալների բազաներ](https://github.com/tavad/tvyal_newsletter), տեսանյութեր, հոդվածներ, [առցանց վահանակներ](https://www.tvyal.com/projects), տնտեսական գործիքներ, կանխատեսումներ և հաշվետվություններ: Եթե ցանկանում եք չեղարկել բաժանորդագրությունը, խնդրում եմ տեղեկացրեք ինձ, և ես կհեռացնեմ ձեր էլ. փոստը ցուցակից: Գրեք նաև եթե ունեք մենկնաբանություններ:**

####### **Important! Your email is part of the mailing list where I share weekly materials primarily focused on the Armenian economy. These materials encompass charts, [databases](https://github.com/tavad/tvyal_newsletter), videos, articles, [online dashboards](https://www.tvyal.com/projects), economic tools, forecasts, and reports. If you wish to unsubscribe, please let me know, and I will remove your email from the list. Please share your comments as well․**







