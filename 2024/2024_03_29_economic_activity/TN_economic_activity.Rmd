---
title: "Tvyal Newsletter"
author: "Aghasi Tavadyan"
date: "2024-03-15"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(rvest)
library(RcppRoll)
library(scales)
library(readxl)

rm(list = ls()); gc()

theme_tvyal <- function(base_size = 12, base_family = "sans")
{
  colors <- deframe(ggthemes::ggthemes_data[["fivethirtyeight"]])
  (ggthemes::theme_foundation(
    base_size = base_size, base_family = base_family) +
      theme(
        line = element_line(colour = "black"),
        rect = element_rect(fill = "white", linetype = 0, colour = NA),
        text = element_text(colour = colors["Dark Gray"]),
        # axis.title = element_blank(),
        # axis.text = element_text(),
        axis.ticks = element_blank(),
        axis.line = element_blank(),
        legend.background = element_rect(),
        legend.position = "bottom",
        legend.direction = "horizontal",
        legend.box = "vertical",
        panel.grid = element_line(colour = NULL),
        panel.grid.major.x = element_line(
          colour = colors["Medium Gray"], 
          linetype = "dotted"
        ),
        panel.grid.major.y = element_line(
          colour = colors["Medium Gray"], 
          linetype = "dotted"
        ),
        panel.grid.minor = element_blank(),
        plot.title = element_text(hjust = 0, size = rel(1.5), face = "bold"),
        plot.margin = unit(c(1, 1, 1, 1), "lines"), strip.background = element_rect()
      )
  )
}

theme_set(theme_tvyal())

save_last_plot <-
  function(filename, extension = "png", width = 1008, height = 567) {

    filename <- str_replace_all(filename, " ", "_")
    last_plot <- recordPlot()

    if (extension == "png") {
      png(paste0(filename, ".", extension), width = width, height = height)
    } else if (extension == "pdf") {
      pdf(paste0(filename, ".", extension), width = width, height = height)
    } else {
      stop("Unsupported file extension. Use 'png' or 'pdf'.")
    }

    replayPlot(last_plot)
    dev.off()
    paste0(filename, ".", extension)
  }

new_palette_colors <- c(
  "#003f5c", "#2f4b7c", "#665191", "#a05195",
  "#d45087", "#f95d6a", "#ff7c43", "#ffa600"
)
colfunc <- colorRampPalette(c("#2f4b7c", "#fffcf5", "#f95d6a"))
colfunc2 <- colorRampPalette(new_palette_colors)
colfunc3 <- colorRampPalette(c("#005C4B", new_palette_colors, "#FFD17A", "#FFFCF5"))

update_geom_defaults("rect", list(fill  = new_palette_colors[2], alpha = 0.8))
update_geom_defaults("line", list(color = new_palette_colors[2], alpha = 0.8))
update_geom_defaults("area", list(fill  = new_palette_colors[2], alpha = 0.8))

caption_arm <-  "Հեղինակ` Աղասի Թավադյան   |   tvyal.com   |   tavadyan.com"
caption_eng <-  "Author: Aghasi Tavadyan   |   tvyal.com   |   tavadyan.com"

doParallel::registerDoParallel(cores = 8)

Sys.setlocale("LC_TIME", "hy_AM.UTF-8")

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))

```

```{r downloading economic activity data, include=FALSE}
national_account_urls <- 
  read_html("https://www.armstat.am/am/?nid=202") |> 
  html_elements("a")

national_account_urls <- 
  tibble(
    url =  national_account_urls |>
      html_attr("href") |> 
      str_replace("../", "https://www.armstat.am/"),
    text = national_account_urls |>
      html_text()
  )

economic_activity_url <- 
  national_account_urls |> 
  filter(grepl("ակտիվության ցուցանիշը", text)) |> 
  pull(url)

economic_activity <- 
  rio::import(economic_activity_url, format = "xls", sheet = 5, skip = 6) %>%
  as_tibble()

activity_colnames <- c("year", "month", "iea", "iea_adjusted")

economic_activity <- 
  economic_activity[,c(1,3,5,6)] %>% #Chain-link indices with seasonal adjustment (2021=100%)
  set_names(activity_colnames) %>% 
  fill(year, .direction = "down") %>% 
  filter(!is.na(year)) %>% 
  mutate(date = ym(paste(year, month))) %>% 
  hablar::retype() |> 
  mutate(
    growth_month = iea / lag(iea),
    growth_adjusted_month = iea_adjusted / lag(iea_adjusted),
    growth_year = iea / lag(iea, n = 12),
    growth_adjusted_year = iea_adjusted / lag(iea_adjusted, n = 12)
  ) |> 
  bind_rows(
    tibble(
      year = 2024,
      month = "February",
      date = ym("2024-02"),
      growth_year = 1.163
    )
  )

economic_activity |> write_csv("economic_activity_celan.csv")
```


```{r, include=FALSE}

economic_activity_change_plot <- 
  economic_activity %>% 
  select(date, growth_adjusted_year, growth_year) |> 
  pivot_longer(c(growth_adjusted_year, growth_year)) |> 
  mutate(
    date = date + months(1) - days(1),
    name = ifelse(
      grepl("adjusted", name), 
      "12-ամսյա ինդեքս սեզոնային ճշգրտումով", 
      "12-ամսյա ինդեքս"
    )
  ) |> 
  # na.omit() |> 
  filter(date >= ym("2018-01")) |> 
  ggplot(aes(date, value - 1, color = name)) +
  geom_line(size = 1.2, alpha = 0.8) +
  geom_smooth() +
  # geom_line(aes(date, growth_adjusted_month)) +
  # geom_line(aes(date, growth_month), color = "red") +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  scale_y_continuous(labels = percent_format()) +
  scale_color_manual(values = new_palette_colors[c(3,6)]) +
  labs(
    x = NULL,
    y = NULL,
    color = NULL,
    title = "Տնտեսական ակտիվության ցուցանիշի (ՏԱՑ) փոփոխությունը",
    subtitle = "12-ամսյա կտրվածքով, նախորդ տարվա նույն ամսվա համեմատ",
    caption =  paste(caption_arm, "   |   Տվյալների աղբյուր՝ armstat.am")
  )

```



```{r second plot, include=FALSE}

economic_activity_last_2_years_comparation_plot <- 
  economic_activity |> 
  # filter(year >= max(year) - 1) |> 
  filter(year %in% c(2022:2023)) |>
  group_by(year) |> 
  mutate(
    month = month(date),
    cum_growth = cumprod(growth_adjusted_month)
  ) |> 
  ggplot(aes(
    ym(paste(2000, month)),
    growth_adjusted_year - 1, 
    fill = as.character(year),
    label = percent(growth_adjusted_year - 1, accuracy = 0.1),
  )) +
  geom_col(position = position_dodge2(preserve = "single")) +
  geom_text(aes(y = growth_adjusted_year - 0.99), position = position_dodge(width = 28)) +
  geom_line(aes(y = cum_growth - 1, color = as.character(year)), size = 1.5) +
  scale_x_date(date_breaks = "1 month", date_labels = "%b") +
  scale_y_continuous(labels = percent_format()) +
  scale_fill_manual(values = new_palette_colors[c(2,6)]) +
  scale_color_manual(values = new_palette_colors[c(1,5)]) +
  labs(
    x = NULL,
    y = NULL,
    color = NULL,
    fill = NULL,
    title = "Տնտեսական ակտիվության ցուցանիշը 2022 2023 թվականներին",
    subtitle = "նախորդ տարվա նույն ամսվա համեմատ, ճշգրտված",
    caption =  paste(caption_arm, "   |   Տվյալների աղբյուր՝ armstat.am")
  ) +
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.major.y = element_blank(),
    axis.text.y = element_blank()
  )

```


```{r processing economic activity factors data, include=FALSE}

activity_factors <- read_csv("EAI_factors.csv")

factors_dict <- 
  tibble(
    order = 1:5,
    factor = c("industry", "agriculture", "construction",  "trade", "services"),
    factor_name_arm = c(
      "Արդյունաբերական արտադրանքի ծավալը", 
      "Գյուղատնտեսության համախառն արտադրանքի ծավալը",
      "Շինարարության ծավալը", "Առևտրի շրջանառությունը",
      "Ծառայությունների ծավալը (առանց առևտրի)"
    )
  )

activity_factors_full_year <- 
  activity_factors |> 
  filter(!is.na(year)) |> 
  filter(month == 13) |> 
  pivot_longer(-c(year, month, name), names_to = "factor") |> 
  pivot_wider() |> 
  select(-month) |> 
  janitor::clean_names() |> 
  left_join(factors_dict, by = "factor") |> 
  mutate(
    factor = fct_reorder(factor, order),
    factor_name_arm = fct_reorder(factor_name_arm, order)
  ) |> 
  group_by(year) |> 
  mutate(
    factor_pct = mln_dram / sum(mln_dram)
  ) |> 
  ungroup()

##################################

activity_factors_month <- 
  activity_factors |> 
  filter(!is.na(year)) |> 
  filter(month != 13) |> 
  mutate(date = ym(paste(year, month)) + months(1) - days(1)) |> 
  pivot_longer(-c(date, year, month, name), names_to = "factor") |> 
  pivot_wider() |> 
  janitor::clean_names() |> 
  left_join(factors_dict, by = "factor") |> 
  mutate(
    factor = fct_reorder(factor, order),
    factor_name_arm = fct_reorder(factor_name_arm, order)
  ) |> 
  arrange(factor, date) |> 
  group_by(factor) |> 
  mutate(
    mln_dram_yoy = roll_sumr(mln_dram, 12),
    across(contains("growth"), ~.x/100)
  )

```


```{r activity_factors_year_plot, include=FALSE}

activity_factors_year_plot_1 <- 
  activity_factors_full_year |> 
  ggplot(aes(year, mln_dram, fill = factor_name_arm)) +
  geom_col() +
  geom_text(
    aes(label = number(mln_dram/1000, accuracy = 1)),
    position = position_stack(vjust = .5)
  ) +
  scale_x_continuous(breaks = 2010:2030) +
  scale_y_continuous(labels = percent_format()) +
  scale_fill_manual(values = colfunc2(5)) +
  labs(
    x = NULL,
    y = NULL,
    color = NULL,
    fill = NULL,
    title = "Տնտեսական ակտիվության ցուցանիշը 2022 2023 թվականներին",
    subtitle = "մլրդ․ դրամ",
    caption =  paste(caption_arm, "   |   Տվյալների աղբյուր՝ armstat.am")
  ) +
  guides(fill = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.major.y = element_blank(),
    axis.text.y = element_blank()
  )


activity_factors_year_plot_2 <- 
  activity_factors_full_year |> 
  mutate(
    factor_pct_txt = percent(factor_pct, accuracy = 0.1)
  ) |> 
  ggplot(aes(year, factor_pct, fill = factor_name_arm, label = factor_pct_txt)) +
  geom_col() +
  geom_text(position = position_stack(vjust = .5)) +
  scale_x_continuous(breaks = 2010:2030) +
  scale_y_continuous(labels = percent_format()) +
  scale_fill_manual(values = colfunc2(5)) +
  labs(
    x = NULL,
    y = NULL,
    color = NULL,
    fill = NULL,
    title = "Տնտեսական ակտիվության ցուցանիշը 2022 2023 թվականներին",
    subtitle = "մլն․ դրամ",
    caption =  paste(caption_arm, "   |   Տվյալների աղբյուր՝ armstat.am")
  ) +
  guides(fill = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.major.y = element_blank(),
    axis.text.y = element_blank()
  )

```

```{r activity_factors_month_trend_plot, include=FALSE}

activity_factors_month_trend_plot <- 
  activity_factors_month |> 
  filter(factor != "agriculture") |> 
  ggplot(aes(date, yoy_growth - 1, color = factor_name_arm)) +
  geom_smooth(size = 1.5) +
  geom_line(size = 1.2) +
  geom_hline(yintercept = 0, color = new_palette_colors[1], linetype = "dotted") +
  facet_wrap(~factor_name_arm, scales = "free_x") +
  scale_y_continuous(breaks = seq(-0.6, 0.6, 0.2), labels = percent_format()) +
  scale_color_manual(values = new_palette_colors[c(2,4,6,8)]) +
  labs(
    x = NULL,
    y = NULL,
    color = NULL,
    title = "Տնտեսական ակտիվության ցուցանիշը 2022 2023 թվականներին",
    subtitle = "մլն․ դրամ",
    caption =  paste(caption_arm, "   |   Տվյալների աղբյուր՝ armstat.am")
  ) +
  theme(
    legend.position = "none",
    strip.text = element_text(face = "bold")
  )

```



***English summary below.***

Հարգելի գործընկեր,

Հուսով եմ լավ եք:
Ներկայացնում եմ այս շաբաթվա վերլուծությունները և աշխատանքները.


## 🚜🌾📉  10 տարվա գյուղատնտեսության կոլափսը

### Գյուղատնտեսությունից սապառողական տնտեսության անցումը


🔍 Տնտեսական ակտիվության ցուցանիշը 2024 թվականի փետրվարին կազմել է 16.3%, հիմնականում պայմանավորված հենց փետրվար ամսում գրանցված աճով՝ 11.2%։

🌱 2024 փետրվար ամսին ծառայությունների ծավալը կրճատվել է 0.3%։ Աճը ապահովել են շինարարությունը, որը աճել է 35.5 տոկոս մեկ ամսվա ընթացքում և առևտուրը՝ 21.0%։

📉 Ընդհանուր առմամբ մինչ փետրվար ամիսը տնտեսական ակտիվության միտումը բացասական էր։
Ճիշտ է մեկ ամիսը դեռ բան չի կարող հիմք լինել որ տնտեսությունը հաղթահարել է անկման միտումը։ Նշեմ նաև որ Հայաստանի արտահանման ավելի քանի 25% ոսկու և ադամանդների վերաարտահանումն է, որը ամենայն հավանականությամբ ապահովում է վերջին ամիսների տնտեսական աճը։

<!-- 🔗 Տվյալների աղբյուր՝ https://www.armstat.am/file/doc/99546023.pdf -->

<!-- 🇦🇲📊🏗️ Իմ կողմից կատարված 2024թ․ ՀՆԱ կանխատեսման սցենարներից մեկը՝ -->
<!-- https://www.facebook.com/a.tavadyan/posts/7642071095812344 -->

<!-- 🇦🇲📊🏗️ 2023թ․ ՀՆԱ վերլուծությունը -->
<!-- https://www.facebook.com/a.tavadyan/posts/7632905843395536 See less -->



**Գծապատկեր 1.**  

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 12, fig.height = 8}
economic_activity_change_plot
```




**Գծապատկեր 2.** 

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 12, fig.height = 8}
economic_activity_last_2_years_comparation_plot
```




**Գծապատկեր 3.** 

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 12, fig.height = 8}
activity_factors_year_plot_1
```


**Գծապատկեր 4.** 

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 12, fig.height = 8}
activity_factors_year_plot_2
```



**Գծապատկեր 5.** 

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 12, fig.height = 8}
activity_factors_month_trend_plot
```

>
> Կարդացեք թե որ ճյուղերն են նպաստում տնտեսական աճին․
>
> [🇦🇲📊🏗️ Հայաստանի 2023թ․ 8.7% տնտեսական աճի հիմնական պատճառները](https://www.tvyal.com/newsletter/2024/2024_03_09)։
>




## ԶԼՄ հաղորդագրություններ

[Դիտեք Նվեր Մնացականյանին տված իմ վերջին հարցազրույցը, որտեղ խոսում եմ 2024 թվականի տնտեսական մարտահրավերների մասին։](https://www.youtube.com/watch?v=4ZI-fFFxr7k)

Հարցազրույցում շոշափվել են հետևյալ թեմաները։

* Երևանը Մոսկվայից ավելի թանկ էր 2023 թվականի ամռանը
* Վերաբնակվողները լքում են Հայաստանը
* Շինարարական բում Հայաստանում՝ կառավարությունը կրկնում է Քոչարյանի սխալները
* Ի՞նչ առավելություններ կտա Եվրոպական ուղին Հայաստանի տնտեսության համար


<a href="https://www.youtube.com/watch?v=4ZI-fFFxr7k">
  <img src="https://i3.ytimg.com/vi/4ZI-fFFxr7k/hqdefault.jpg" alt="YouTube Video" style="width:60%;">
</a>


## English Summary

### 🚜🌾📉️ 10 years of agricultural collapse



---

Այս վերլուծությունը առկա է նաև [մեր կայքէջում](https://www.tvyal.com/newsletter/2024/2024_03_15), այս վերլուծության կոդը և տվյալները դրված են նաև [Github-ում](https://github.com/tavad/tvyal_newsletter)։       

---                  

Եթե հնարավոր է, խնդրում եմ այս նյութը ուղարկել նաև այն մարդկանց, ում այն կարծում եք կարող է հետաքրքրել:

Սպասեք հաջորդ հաղորդագրությանը հաջորդ ուրբաթ օրը:      


Հարգանքներով,            
Աղասի Թավադյան         
15.03.2024          
[tvyal.com](https://www.tvyal.com/)      
[tavadyan.com](https://www.tavadyan.com/)

---

[Was this email forwarded to you? Subscribe here.](https://www.tvyal.com/subscribe)

[Բաժանորդագրվեք](https://www.tvyal.com/subscribe)

       
---              
               


####### **Ուշադրություն. Ձեր էլ.փոստը մեյլիսթի մեջ է, որի միջոցով ես կիսվում եմ շաբաթական նյութեր, որոնք հիմնականում ներկայացնում են Հայաստանի տնտեսությանը: Նյութերը ներառում են գծապատկերներ, [տվյալների բազաներ](https://github.com/tavad/tvyal_newsletter), տեսանյութեր, հոդվածներ, [առցանց վահանակներ](https://www.tvyal.com/projects), տնտեսական գործիքներ, կանխատեսումներ և հաշվետվություններ: Եթե ցանկանում եք չեղարկել բաժանորդագրությունը, խնդրում եմ տեղեկացրեք ինձ, և ես կհեռացնեմ ձեր էլ. փոստը ցուցակից: Գրեք նաև եթե ունեք մենկնաբանություններ:**

####### **Important! Your email is part of the mailing list where I share weekly materials primarily focused on the Armenian economy. These materials encompass charts, [databases](https://github.com/tavad/tvyal_newsletter), videos, articles, [online dashboards](https://www.tvyal.com/projects), economic tools, forecasts, and reports. If you wish to unsubscribe, please let me know, and I will remove your email from the list. Please share your comments as well․**





