---
title: "Tvyal Newsletter"
author: "Aghasi Tavadyan"
date: "2024-04-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(RcppRoll)
library(scales)
library(rvest)
library(readxl)
library(gt)

rm(list = ls()); gc()

theme_tvyal <- function(base_size = 12, base_family = "sans")
{
  colors <- deframe(ggthemes::ggthemes_data[["fivethirtyeight"]])
  (ggthemes::theme_foundation(
    base_size = base_size, base_family = base_family) +
      theme(
        line = element_line(colour = "black"),
        rect = element_rect(fill = "white", linetype = 0, colour = NA),
        text = element_text(colour = colors["Dark Gray"]),
        # axis.title = element_blank(),
        # axis.text = element_text(),
        axis.ticks = element_blank(),
        axis.line = element_blank(),
        legend.background = element_rect(),
        legend.position = "bottom",
        legend.direction = "horizontal",
        legend.box = "vertical",
        panel.grid = element_line(colour = NULL),
        panel.grid.major.x = element_line(
          colour = colors["Medium Gray"], 
          linetype = "dotted"
        ),
        panel.grid.major.y = element_line(
          colour = colors["Medium Gray"], 
          linetype = "dotted"
        ),
        panel.grid.minor = element_blank(),
        plot.title = element_text(hjust = 0, size = rel(1.5), face = "bold"),
        plot.margin = unit(c(1, 1, 1, 1), "lines"), strip.background = element_rect()
      )
  )
}

theme_set(theme_tvyal())

save_last_plot <-
  function(filename, extension = "png", width = 1008, height = 567) {

    filename <- str_replace_all(filename, ", ", "_")
    last_plot <- recordPlot()

    if (extension == "png") {
      png(paste0(filename, ".", extension), width = width, height = height)
    } else if (extension == "pdf") {
      pdf(paste0(filename, ".", extension), width = width, height = height)
    } else {
      stop("Unsupported file extension. Use 'png' or 'pdf'.")
    }

    replayPlot(last_plot)
    dev.off()
    paste0(filename, ".", extension)
  }

new_palette_colors <- c(
  "#003f5c", "#2f4b7c", "#665191", "#a05195",
  "#d45087", "#f95d6a", "#ff7c43", "#ffa600"
)
colfunc <- colorRampPalette(c("#2f4b7c", "#fffcf5", "#f95d6a"))
colfunc2 <- colorRampPalette(new_palette_colors)
colfunc3 <- colorRampPalette(c("#005C4B", new_palette_colors, "#FFD17A", "#FFFCF5"))

test_colors <- c("#005C4B", "#FFD485", "#00415A", "#FFAD16",  "#264876", "#FF8730", "#564F8B", "#FB685B", "#8A5193", "#E45579",  "#BC508D")

update_geom_defaults("rect", list(fill  = new_palette_colors[2], alpha = 0.8))
update_geom_defaults("line", list(color = new_palette_colors[2], alpha = 0.8))
update_geom_defaults("area", list(fill  = new_palette_colors[2], alpha = 0.8))

caption_arm <-  "Հեղինակ` Աղասի Թավադյան   |   tvyal.com   |   tavadyan.com"
caption_eng <-  "Author: Aghasi Tavadyan   |   tvyal.com   |   tavadyan.com"

doParallel::registerDoParallel(cores = 8)

Sys.setlocale("LC_TIME", "hy_AM.UTF-8")

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))

```


```{r get raw data, include=FALSE}

BoP_url <- read_html("https://www.armstat.am/am/?nid=203") |> 
  html_element(xpath = '//a[text()="Վճարային հաշվեկշիռ 6"]') |> 
  html_attr("href") |> 
  str_replace("\\.{2}", "https://www.armstat.am")

httr::GET(BoP_url, httr::write_disk(BoP_tempfile <- tempfile(fileext = ".xls")))

BoP_raw <- read_excel(BoP_tempfile, sheet = 1, skip = 4, trim_ws = FALSE)

```


```{r clean data, include=FALSE}

BoP_levels_dict = read_csv("levels_dict.csv")

BoP_semiraw <- 
  BoP_raw |> 
  rename(eng = 1, rus = 2, arm = 3) |>
  filter(!is.na(eng)) |> 
  mutate(
    nrow = row_number(),
    across(c(eng, rus, arm), ~str_trim(.x)),
    across(c(eng, rus, arm), ~str_replace_all(.x, "  ", " "))
  ) |> 
  left_join(BoP_levels_dict, by = join_by(nrow, eng)) |> 
  mutate(
    group = ifelse(grepl("^\\d\\.", eng), eng, NA),
    account = case_when(
      grepl("credit", tolower(eng)) ~ "Credit",
      grepl("debit", tolower(eng)) ~ "Debit",
      TRUE ~ "account"
    )
  ) |> 
  filter(eng != "") |> 
  fill(group, .direction = "down") |> 
  mutate(
    level = ifelse(is.na(codes), NA, level),
    across(c(eng, arm, rus), ~ifelse(account == eng, NA, .x))
  ) |> 
  fill(c(codes, level, eng, rus, arm), .direction = "down") |> 
  relocate(codes, level, eng, rus, arm)

BoP_semiraw |>  write_csv("BoP_semiraw.csv")
  
services_plot_data <- 
  BoP_semiraw |> 
  filter(
    grepl("^1.1.2.", codes),
    level == 4,
    !codes %in% c("1.1.2.X.")
  ) |>  
  pivot_longer(matches("\\d{4}"), names_to = "date") |> 
  mutate(
    date = yq(date) + months(3) - days(1),
    across(c(codes, eng, rus, arm), ~fct_inorder(.x)),
    account = case_when(
      account == "Credit" ~ "Արտահանում",
      account == "Debit" ~ "Ներմուծում",
      TRUE ~ account
    )
  ) |> 
  arrange(codes, account, date) |> 
  group_by(codes, account) |>  
  mutate(value_yoy = roll_sumr(value, 4)) |> 
  ungroup() |> 
  na.omit()

services_plot_data |> write_csv("services_plot_data.csv")

```


```{r, include=FALSE}

plot_data <- 
  BoP_semiraw |> 
  filter(codes == "1.1.") |> 
  pivot_longer(matches("\\d{4}"), names_to = "date") |> 
  mutate(
    date = yq(date) + months(3) - days(1),
    across(c(codes, eng, rus, arm), ~fct_inorder(.x))
  ) |> 
  arrange(codes, account, date) |> 
  group_by(codes, account) |>  
  mutate(value_yoy = roll_sumr(value, 4)) |> 
  ungroup() |> 
  mutate(month = month(date), year = year(date)) |> 
  filter(
    account != "account",
    date >= ymd("2013-12-31"),
  ) |> 
  na.omit()


plot_data_1 <- 
  plot_data |> 
  mutate(
    account = case_when(
      account == "Credit" ~ "Արտահանում",
      account == "Debit" ~ "Ներմուծում",
      TRUE ~ account
    )
  )
  
plot_data_2 <- 
  plot_data |> 
  filter(
    month == 12,
    year >= 2014
  ) |> 
  select(date, month, year, account, value_yoy) |> 
  na.omit() |> 
  pivot_wider(names_from = account, values_from = value_yoy) |> 
  mutate(
    diff = Debit / Credit - 1,
    diff_text = percent(diff, accuracy = 0.1),
    date = date + days(1) - months(6)
  )

import_export_plot <- 
  plot_data_2 |> 
  ggplot() +
  geom_col(
    mapping = aes(date, diff* 10, fill = "Ներմուծում / Արտահանում"),
    width = 200
  ) +
  geom_text(
    mapping = aes(date, y = 0, label = diff_text), vjust = -0.5
  ) +
  geom_line(
    data = plot_data_1,
    aes(date, value_yoy / 1000, color = account), size = 1.2
  ) +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  scale_y_continuous(
    breaks = seq(0, 14, 2),
    labels = number_format(accuracy = 1),
    sec.axis = sec_axis(
      transform = ~./10,
      breaks = seq(0, 1.4, 0.2),
      labels = percent_format(accuracy = 1)
    )
  ) +
  scale_color_manual(values = new_palette_colors[c(6,8)]) +
  scale_fill_manual(values = new_palette_colors[c(2)]) +
  guides(
    color = guide_legend(ncol = 2),
    fill = guide_legend(ncol = 2)
  ) +
  labs(
    x = NULL,
    y = NULL,
    color = NULL,
    fill = NULL,
    title = "Ապրանքների և ծառայությունների արտահանման և ներմուծման դինամիկան Հայաստանում",
    subtitle = "մլրդ ԱՄՆ դոլար, տասյերկուամսյա կտրվածքով",
    caption = paste0(caption_arm, "   |   տվյալների աղբյուր՝ armstat.am")
  ) +
  theme(
    legend.box = "horizontal",
  )


```

```{r, include=FALSE}

services_plot_data_new |> count(eng)

services_plot_data_new <- 
  services_plot_data |> 
  mutate(
    arm = str_trunc(as.character(arm), 40),
    arm = case_when(
      grepl("^Հեռա", arm) ~ "ՏՏ, հեռահաղորդակցություն",
      TRUE ~ arm
    )
  )

second_table <- 
  services_plot_data_new |> 
  mutate(
    year = year(date),
    month = month(date)
  ) |> 
  filter(
    year == max(year)
  ) |> 
  arrange(arm, account, date) |> 
  group_by(arm, account) |> 
  mutate(
    pct_growth = value / lag(value) - 1,
    text = paste0(
      "<br><span style='color: gray;'>",
      percent(pct_growth, accuracy = 0.1), "</span>"
    )
  ) |> 
  filter(
    month == 12,
    account == "Արտահանում"
  ) |> 
  ungroup() |> 
  select(year, arm, text) |> 
  pivot_wider(names_from = year, values_from = text) |>
  rename(`2023 Q4*` = `2023`)


services_growth_gt_table <- 
  services_plot_data_new |> 
  mutate(
    year = year(date),
    month = month(date)
  ) |> 
  filter(month == 12) |> 
  arrange(arm, account, year) |> 
  group_by(arm, account) |> 
  mutate(
    pct_growth = value_yoy / lag(value_yoy) - 1,
    text = paste0(
      number(value_yoy, accuracy = 0.1),
      "<br><span style='color: gray;'>",
      percent(pct_growth, accuracy = 0.1), "</span>"
    )
  ) |> 
  filter(
    year >= 2018,
    account == "Արտահանում"
  ) |> 
  ungroup() |> 
  mutate(
    arm = fct_reorder(arm, value_yoy) |> fct_rev()
  ) |> 
  mutate(
    info = "մլն $<br><span style='color: gray;'>աճ</span>"
  ) |> 
  select(year, arm, info, text) |> 
  pivot_wider(names_from = year, values_from = text) |>
  arrange(arm) |> 
  left_join(second_table, by = "arm") |> 
  gt() |> 
  fmt_markdown(columns = everything()) |> 
  cols_align(align = "left", columns = c(arm, info)) |> 
  cols_align(align = "right", columns = -c(arm, info)) |> 
  cols_label(
    arm = "Ծառայության անվանումը",
    info = ""
  ) |> 
  tab_header(
    title = "Հայաստանի ծառայությունների արտահանման միտումը 2018-2023",
    subtitle = "միլիոն ԱՄՆ դոլար"
  ) |> 
  tab_footnote(
    footnote = "* 2023 Q4 - 2023 թվականի չորրորդ եռամսյակի հարաբերակցությունը երրորդ եռամսյակին"
  ) |> 
  tab_footnote(
    footnote = paste0(caption_eng, "    |    Data Source: armstat.am")
  )





```



```{r services charts, include=FALSE}

services_plot_data_2 <- 
  services_plot_data |> 
  filter(date >= as.Date("2009-12-31")) |> 
  mutate(
    value_lamp = ifelse(account == "account", 0, value_yoy),
    arm = str_trunc(as.character(arm), 30),
    arm = case_when(
      grepl("^Այլ", arm) ~ "Այլ ծառայություննր",
      grepl("^Հեռա", arm) ~ "ՏՏ, հեռահաղորդակցություն",
      TRUE ~ arm
    ),
    arm = fct_lump_n(arm, 8, w = value_lamp, other_level = "Այլ ծառայություննր"),
    arm = fct_reorder(arm, value_yoy)
  ) |> 
  group_by(date, account, arm) |> 
  summarise(value_yoy = sum(value_yoy), .groups = "drop")



services_change_plot_1 <- 
  services_plot_data_2 |> 
  filter(account != "account") |> 
  ggplot(aes(date, value_yoy / 1e3, fill = arm)) +
  geom_area(alpha = 0.8) +
  facet_wrap(~account) +
  scale_x_date(
    breaks = as.Date(ISOdate(seq(2000, 2024, 2), 1, 1)),
    date_labels = "%Y"
  ) +
  scale_y_continuous(breaks =1:10, labels = number_format()) +
  scale_fill_manual(values =   rev(colfunc3(9)[-9])) +
  guides(fill = guide_legend(nrow = 2, reverse = TRUE)) +
  labs(
    x = NULL,
    y = NULL,
    fill = NULL,
    title = "Հայաստանի ծառայությունների տասերկուամսյա արտահանումը և ներմուծումը ըստ ոլորտների",
    subtitle = "մլրդ ԱՄՆ դոլար",
    caption = paste0(caption_arm, "   |   տվյալների աղբյուր՝ armstat.am")
  )

services_change_plot_2 <- 
  services_plot_data_2 |> 
  filter(account != "account") |> 
  group_by(date, account) |> 
  mutate(pct = value_yoy / sum(value_yoy)) |> 
  ungroup() |> 
  ggplot(aes(date, pct, fill = arm)) +
  geom_area(alpha = 0.8) +
  facet_wrap(~account) +
  scale_x_date(
    breaks = as.Date(ISOdate(seq(2000, 2024, 2), 1, 1)),
    date_labels = "%Y"
  ) +
  scale_y_continuous(labels = percent_format()) +
  scale_fill_manual(values =   rev(colfunc3(9)[-9])) +
  guides(fill = guide_legend(nrow = 2, reverse = TRUE)) +
  labs(
    x = NULL,
    y = NULL,
    fill = NULL,
    title = "Հայաստանի ծառայությունների արտահանումը և ներմուծումը ըստ ոլորտների",
    subtitle = "տեսակարար կշիռ",
    caption = paste0(caption_arm, "   |   տվյալների աղբյուր՝ armstat.am")
  )

services_change_plot_3 <- 
  services_plot_data_2 |> 
  filter(account == "account") |> 
  ggplot(aes(date, value_yoy / 1e3, fill = arm)) +
  geom_area(alpha = 0.8) +
  scale_x_date(
    breaks = as.Date(ISOdate(seq(2000, 2024, 2), 1, 1)),
    date_labels = "%Y"
  ) +
  scale_y_continuous(labels = number_format(), n.breaks = 8) +
  scale_fill_manual(values =   rev(colfunc3(9)[-9])) +
  guides(fill = guide_legend(nrow = 2, reverse = TRUE)) +
  labs(
    x = NULL,
    y = NULL,
    fill = NULL,
    title = "Հայաստանի ծառայությունների հաշվեկշիռը",
    subtitle = "մլրդ ԱՄՆ դոլար",
    caption = caption_arm
  )

```



***English summary below.***

Հարգելի գործընկեր,

Հուսով եմ լավ եք:
Ներկայացնում եմ այս շաբաթվա վերլուծությունները և աշխատանքները.

**ՈՒՇԱԴՐՈՒԹՅՈՒՆ․ ՄԵՆՔ !!PODCAST!! ՈՒՆԵՆՔ․ ՄԱՆՐԱՄԱՍՆԵՐԸ ՆԵՐՔԵՎՈՒՄ**

## Ծառայությունների ապրանքաշրջանառության փոփոխությունը





>
> 2100 թվականին այլ հավասար պայմաններում Հայաստանում բնակվելու է **2 միլիոն** հայ:
>


**Գծապատկեր 1.**  

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 12, fig.height = 8}
import_export_plot
```





**Գծապատկեր 2.** 
```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 12, fig.height = 8}
services_change_plot_1
```




>
> Ձեզ կարող է հետաքրքրել նաև հետևյալ վերլուծությունը.
>
> [💹💳 Մասնավոր աշխատատեղերի 76 տոկոսը Երևանում է](https://www.tvyal.com/newsletter/2024/2024_02_09)։
>




**Գծապատկեր 3.** 
```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 12, fig.height = 8}
services_change_plot_2
```



>
> Հայաստանի ընտանիքների ուսումնասիրությունը ըստ սեռատարիքային կազմի և եկամտի մակարդակի կարող եք կարդալ այստեղ.
>
> [👨‍👩‍👧‍👦✨ Ամուր ընտանիք․ հարուստ ընտանիք](https://www.tvyal.com/newsletter/2024/2024_01_26)։
>



**Գծապատկեր 4.** 
```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 12, fig.height = 8}
services_change_plot_3
```


**Աղյուսակ 1.** 
```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 12, fig.height = 8}
services_growth_gt_table
```





## PODCAST !!

### Խոսենք թվերով #5

[Ինչքա՞ն հայ կունենանք Հայաստանում 2100 թվականին](https://www.youtube.com/watch?v=-IOVtoBD5gE)

- 🔘 Ինչքա՞ն է Հայաստանի բնակչությունը և ինչպե՞ս է փոխվում վերջին տարիներին
- 🔘 Ի՞նչ է լինելու արցախահայերի, ռուսների և հնդիկների գալով
- 🔘 Ինչպիսի՞ն է Հայաստանի բնակչության սեռատարիքային կազմը
- 🔘 Ինչքա՞ն հայ կունենանք առաջիկայում

How2B-ում «խոսում ենք թվերով»՝ տնտեսագետ Աղասի Թավադյանի հետ:

- 00:00 Ժողովրդագրական ընդհանուր իրավիճակը Հայաստանում
- 01։53 Դեմոգրաֆիկ փուլերն աշխարհում վերջին 100 տարիներին
- 03։06 Հայաստանի բնակչության փոփոխությունը վերջին 30 տարիներին
- 06:57 Հայաստան են եկել ռուսներ, արցախահայեր, հնդիկներ․ Ինչպե՞ս է փոխվում իրավիճակը
- 10:44 Մենք էլ ենք դառնում ծերացող ազգ 
- 12։22 Կանայք Հայաստանում ավելի շատ են, թեև աղջիկ երեխաներ ավելի քիչ են ծնվում
- 17։55 Ամփոփում ենք

Թեմայով վերլուծությունը ներկայացված է tvyal.com կայքում՝
[👫🧭💀 Հայաստանում 2 մլն հայ 2100 թվականին](https://www.tvyal.com/newsletter/2024/2024_04_19)

<a href="https://www.youtube.com/watch?v=-IOVtoBD5gE">
  <img src="https://i3.ytimg.com/vi/-IOVtoBD5gE/hqdefault.jpg" alt="YouTube Video" style="width:60%;">
</a>


## ԶԼՄ հաղորդագրություն


[Դիտեք Civilnet2-ին տված իմ վերջին հարցազրույցը, որտեղ խոսում եմ 2024 թվականի տնտեսական մարտահրավերների մասին։](https://youtu.be/3HyOvSfikwo)

📺  Ոսկու տենդը Հայաստանում թափ է հավաքում. Աղասի Թավադյան 📺

Հարցազրույցում շոշափվել են հետևյալ թեմաները։

- 🎯 Ոսկին դարձել է Հայաստանից արտահանվող հիմնական ապրանքը, որի տեսակարար կշիռն արտահանման ծավալում շարունակում է աճել.


<a href="https://youtu.be/3HyOvSfikwo">
  <img src="https://i3.ytimg.com/vi/3HyOvSfikwo/hqdefault.jpg" alt="YouTube Video" style="width:60%;">
</a>



## English Summary

### 👫🧭💀 2 million Armenians in Armenia in 2100

**Demography Analysis of Armenia**





---

Այս վերլուծությունը առկա է նաև [մեր կայքէջում](https://www.tvyal.com/newsletter/2024/2024_04_26), այս վերլուծության կոդը և տվյալները դրված են նաև [Github-ում](https://github.com/tavad/tvyal_newsletter)։       

---                  

Եթե հնարավոր է, խնդրում եմ այս նյութը ուղարկել նաև այն մարդկանց, ում այն կարծում եք կարող է հետաքրքրել:

Սպասեք հաջորդ հաղորդագրությանը հաջորդ ուրբաթ օրը:      


Հարգանքներով,            
Աղասի Թավադյան         
26.04.2024          
[tvyal.com](https://www.tvyal.com/)      
[tavadyan.com](https://www.tavadyan.com/)

---

[Was this email forwarded to you? Subscribe here.](https://www.tvyal.com/subscribe)

[Բաժանորդագրվեք](https://www.tvyal.com/subscribe)

       
---              
               


####### **Ուշադրություն. Ձեր էլ.փոստը մեյլլիսթի մեջ է, որի միջոցով ես կիսվում եմ շաբաթական նյութեր, որոնք հիմնականում ներկայացնում են Հայաստանի տնտեսությունը: Նյութերը ներառում են գծապատկերներ, [տվյալների բազաներ](https://github.com/tavad/tvyal_newsletter), տեսանյութեր, հոդվածներ, [առցանց վահանակներ](https://www.tvyal.com/projects), տնտեսական գործիքներ, կանխատեսումներ և հաշվետվություններ: Եթե ցանկանում եք չեղարկել բաժանորդագրությունը, խնդրում եմ տեղեկացրեք ինձ, և ես կհեռացնեմ ձեր էլ. փոստը ցուցակից: Գրեք նաև եթե ունեք մենկնաբանություններ:**

####### **Important! Your email is part of the mailing list where I share weekly materials primarily focused on the Armenian economy. These materials encompass charts, [databases](https://github.com/tavad/tvyal_newsletter), videos, articles, [online dashboards](https://www.tvyal.com/projects), economic tools, forecasts, and reports. If you wish to unsubscribe, please let me know, and I will remove your email from the list. Please share your comments as well․**





