---
title: "2022 թվականի տնային տնտեսությունների եկամուտների վերլուծություն"
author: "Աղասի Թավադյան, tvyal.com"
date: "2024-01-12"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(scales)
library(readxl)
library(Hmisc)
library(ggridges)

rm(list = ls()); gc()

theme_tvyal <- function(base_size = 12, base_family = "sans") 
{
  colors <- deframe(ggthemes::ggthemes_data[["fivethirtyeight"]])
  (ggthemes::theme_foundation(
    base_size = base_size, base_family = base_family) + 
      theme(
        line = element_line(colour = "black"), 
        rect = element_rect(fill = "white", linetype = 0, colour = NA),
        text = element_text(colour = colors["Dark Gray"]), 
        # axis.title = element_blank(),
        # axis.text = element_text(), 
        axis.ticks = element_blank(),
        axis.line = element_blank(), 
        legend.background = element_rect(), 
        legend.position = "bottom", 
        legend.direction = "horizontal", 
        legend.box = "vertical", 
        panel.grid = element_line(colour = NULL), 
        panel.grid.major = element_line(colour = colors["Medium Gray"]), 
        panel.grid.minor = element_blank(), 
        plot.title = element_text(hjust = 0, size = rel(1.5), face = "bold"),
        plot.margin = unit(c(1, 1, 1, 1), "lines"), strip.background = element_rect()
      )
  )
}

theme_set(theme_tvyal())

save_last_plot <- 
  function(filename, extension = "png", width = 1344, height = 756) {
    
    filename <- str_replace_all(filename, " ", "_")
    last_plot <- recordPlot()
    
    if (extension == "png") {
      png(paste0(filename, ".", extension), width = width, height = height)
    } else if (extension == "pdf") {
      pdf(paste0(filename, ".", extension), width = width, height = height)
    } else {
      stop("Unsupported file extension. Use 'png' or 'pdf'.")
    }
    
    replayPlot(last_plot)
    dev.off()
    paste0(filename, ".", extension)
  }

new_palette_colors <- c(
  "#003f5c", "#2f4b7c", "#665191", "#a05195", 
  "#d45087", "#f95d6a", "#ff7c43", "#ffa600"
)
colfunc <- colorRampPalette(c("#2f4b7c", "#fffcf5", "#f95d6a"))
colfunc2 <- colorRampPalette(new_palette_colors)
colfunc3 <- colorRampPalette(c(new_palette_colors, "#FFD17A", "#FFFCF5"))

update_geom_defaults("rect", list(fill  = new_palette_colors[2], alpha = 0.8)) 
update_geom_defaults("line", list(color = new_palette_colors[2], alpha = 0.8))
update_geom_defaults("area", list(fill  = new_palette_colors[2], alpha = 0.8))

caption_arm <-  "Հեղինակ` Աղասի Թավադյան   |   tvyal.com   |   tavadyan.com"
caption_eng <-  "Author: Aghasi Tavadyan   |   tvyal.com   |   tavadyan.com"

doParallel::registerDoParallel(cores = 8)

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
```

```{r data download, include=FALSE}
# Household database is aggregated from this official source:
# https://www.armstat.am/en/?nid=205

household_income_db <- read_csv("household_income_db.csv")

data_37 <- read_csv("~/R/projects/t/data_37.csv")

# consumer price index is downloaded from cba.am:
#https://www.cba.am/en/sitepages/statrealsector.aspx
# commencement and run only to update the database

# system(
#   paste0(
#     "curl \"", "https://www.cba.am/stat/stat_data_eng/6_CPI_eng.xls", "\"",
#     " -o ", "\"cpi_armenia_eng.xls\""
#   )
# )

inflation_row <- read_excel("cpi_armenia_eng.xls", skip = 3)

inf_cumprod <- 
  inflation_row |> 
  rename(date = 1, cpi_m = 2) |> 
  select(date, cpi_m) |> 
  mutate(
    date = ym(date),
    cpi_m = cpi_m / 100,
    year = year(date)
  ) |> 
  filter(year <= 2022) |>
  select(-year) |> 
  arrange(desc(date)) |> 
  mutate(
    adj_price = cumprod(cpi_m),
    adj_price = adj_price / first(adj_price)
  )

marz_dict <- 
  tibble(
    marz = 1:12,
    marz_eng = c(
      "Yerevan", "Aragatsotn", "Ararat", "Armavir", "Gegharkunik", "Lori", 
      "Kotayk", "Shirak", "Syunik", "Vayots Dzor", "Tavush", "Armenia"
    ),
     marz_arm = c(
      "Երևան", "Արագածոտն", "Արարատ", "Արմավիր", "Գեղարքունիք", "Լոռի",
       "Կոտայք", "Շիրակ", "Սյունիք", "Վայոց ձոր", "Տավուշ", "Հայաստան"
    )
  )
```


```{r income_table, include=FALSE}
income_table <- 
  household_income_db |> 
  left_join(inf_cumprod, by = "date") |> 
  mutate(totincome = totincome * adj_price) |> 
  filter(marz == 1) |>
  group_by(year) |> 
  summarise(
    q10 = wtd.quantile(totincome, weight, probs = 0.1),
    median = wtd.quantile(totincome, weight, probs = 0.5),
    mean = sum(totincome*weight)/sum(weight),
    q90 = wtd.quantile(totincome, weight, probs = 0.9),
  ) |> 
  mutate(
    across(-year, ~number(.x/1000, accuracy = 1))
  ) |> 
  knitr::kable(
    align = c("l", "r", "r", "r", "r"),
    col.names = c(
      "Տարի", "Ամենաաղքատ 10%-ի վերին շեմը (1-ին դեցիլ)",
      "Միջին ընտանիքի եկամուտ (median)",
      "Միջին եկամուտ (mean)", "Ամենահարուստ 10%-ի ստորին շեմը (9-րդ դեցիլ)"
    ),
    caption = "**Հայաստանի տնային տնտեսությունների եկամուտների փոփխությունը\nհազար դրամ, եկամուտնեը ճշգրտվել են 2022 թվականի վերջի գներով և կշռվել**",
    label = paste0(caption_arm, "    |    տվյալների աղբյուր` armstat.am"),
    col.width = c("5cm", "2cm", "2cm")
  )
  
```


```{r 2021 2022 change, include=FALSE}

years_select = c(2021, 2022) # provide 2 consecutive years that are in household_income_db

date_legend <- 
  tibble(
    x = 710, y = c(1.5, 2.5), 
    color = c("#2f4b7c", "#f95d6a"), text = years_select
  )

household_change_in_2_years_plot <- 
  household_income_db %>%
  bind_rows(
    mutate(., marz = 12)
  ) |> 
  left_join(inf_cumprod, by = "date") |> 
  mutate(totincome = totincome * adj_price) |> 
  group_by(year, marz) |>  
  summarise(
    mean = sum(totincome*weight)/sum(weight),
    median = wtd.quantile(totincome, weight, probs = 0.5),
    q10 = wtd.quantile(totincome, weight, probs = 0.1),
    q90 = wtd.quantile(totincome, weight, probs = 0.9),
  ) |>
  pivot_longer(-c(year, marz)) |> 
  left_join(marz_dict, by = "marz") |> 
  filter(
    year %in% years_select,
    name != "mean"
  ) |> 
  ungroup() |> 
  mutate(
    value = value / 1000,
    year = ifelse(year == min(year), "begining", "end")
  ) |> 
  pivot_wider(names_from = year, values_from = value) |> 
  mutate(
    marz_arm = fct_reorder(marz_arm, (begining + end)/2, .fun = mean),
    marz_eng = fct_reorder(marz_eng, (begining + end)/2, .fun = mean),
    color = ifelse(begining > end, "#f95d6a", "#2f4b7c")
  ) |> 
  ggplot() +
  geom_segment(
    aes(x = begining, xend= end,  y= marz_arm, 
        yend=marz_arm, group = name, color = I(color)),
    linewidth = 1.2,
    lineend = 'round', linejoin = 'round',
   arrow = arrow(length = unit(0.1, "inches"))
  ) +
  geom_point(aes(x=begining, y=marz_arm, color=I("#f95d6a")), size = 3) +
  geom_point(aes(x=end, y=marz_arm, color=I("#2f4b7c")), size = 3) +
  geom_point(data = date_legend, aes(x, y, color = I(color)), size = 3) +
  geom_text(data = date_legend, aes(x + 25, y, label = text)) +
  geom_vline(xintercept = c(170, 390)) +  #dividers are changed manually
  annotate(
    geom = "text", x = c(95, 280, 595), y = 13, #dividers are changed manually
    label = c(
      "Ամենաաղքատ 10%-ի\nվերին շեմը (1-ին դեցիլ)",
      "Միջին ընտանիքի\nեկամուտ (median)",
      "Ամենահարուստ 10%-ի\nստորին շեմը (9-րդ դեցիլ)"
    )
  ) +
  scale_x_continuous(breaks = seq(0, 800, 100), labels = number_format()) +
  scale_y_discrete(expand = c(0.05,0,0.2,0)) +
  labs(
    x = NULL,
    y = NULL,
    color = NULL,
    title = "Տնային տնտեսությունների եկամուտների փոփոխությունը ըստ մարզերի",
    subtitle = "2022-ին Հայաստանի եկամուտները պակասել են, բացի Կոտայքի, Գեղարքունիքի և Տավուշի մարզից,\nհազար ՀՀ դրամ",
    caption = paste0(caption_arm, "    |    տվյալների աղբյուր` armstat.am")
  )
```


```{r income change from 2018 to 2022, include=FALSE}

wealth_change_data <- 
  household_income_db %>%
  bind_rows(
    mutate(., settlement = "Total")
  ) |> 
  left_join(inf_cumprod, by = "date") |> 
  mutate(totincome = totincome * adj_price) |> 
  group_by(year, settlement) |> 
  summarise(
    mean = sum(totincome*weight)/sum(weight),
    median = wtd.quantile(totincome, weight, probs = 0.5),
    q10 = wtd.quantile(totincome, weight, probs = 0.1),
    q90 = wtd.quantile(totincome, weight, probs = 0.9),
  )

household_change_18_22_plot <- 
  wealth_change_data |> 
  pivot_longer(c(mean, median, q10, q90)) |> 
  filter(year %in% 2018:2022) |> 
  mutate(
    settlement = factor(
      settlement,
      levels = c("Total", "Yerevan", "urban", "rural"),
      labels = c("Հայաստան", "Երևան", "այլ քաղաքներ", "գյուղեր")
    ),
    name = factor(
      name, 
      levels = c("q10", "median", "mean", "q90"),
      labels = c("Ամենաաղքատ 10%-ի վերին\nշեմը (1-ին դեցիլ)", "Միջին ընտանիքի եկամուտ\n(median)",
                 "Միջին եկամուտ\n(mean)", "Ամենահարուստ 10%-ի ստորին\nշեմը (9-րդ դեցիլ)")
    ),
    text = number(value / 1000, accuracy = 1)
  ) |> 
  ggplot(aes(as.factor(year), value, label = text, fill = as.factor(year))) +
  geom_col() +
  geom_text(aes(y = 50000), color = "white") +
  facet_grid(settlement~name, switch = "both") +
  scale_fill_manual(values = new_palette_colors[6:2]) +
  labs(
    y = NULL,
    x = NULL,
    fill = NULL,
    title = "Հայաստանի տնային տնտեսությունների եկամուտների փոփոխությունը",
    subtitle = "Հազար դրամ, եկամուտնեը ճշգրտվել են 2022 թվականի վերջի գներով և կշռվել",
    caption = paste0(caption_arm, "    |    տվյալների աղբյուր` armstat.am")
  ) +
  theme(
    axis.text = element_blank(),
    panel.grid.major = element_blank()
  )
```


```{r percentage change, include=FALSE}

household_pct_change_plot <- 
  household_income_db |> 
  select(year, date, weight, marz, totincome) |> 
  left_join(inf_cumprod, join_by(date)) |> 
  mutate(totincome = totincome * adj_price) |>
  mutate(
    income_bin = cut(
      totincome/1000,
      breaks = c(0, 2^(4:11), 1e5),
      include.lowest = TRUE
    )
  ) |> 
  group_by(year) |> 
  # begin weighting data
  count(year, income_bin, wt = weight) |> 
  # end weighting data
  group_by(year) |> 
  extract(income_bin, into = c("lower_cut", "upper_cut"),
          regex = ".(.*),(.*)\\]", remove = FALSE, convert = TRUE) |> 
  mutate(
    pct = n/sum(n),
    label = case_when(
      lower_cut == 0 ~ paste0(upper_cut, " հազար դրամից պակաս"),
      upper_cut == 1e5 ~ paste0(round(lower_cut/1000), " մլն. դրամից ավել"),
      lower_cut == 512 ~ paste0(lower_cut, " հազար դրամից մինչև ",
                                round(upper_cut/1000), " մլն. դրամ"),
      lower_cut > 1000 ~ paste0(round(lower_cut/1000), "-ից մինչև ",
                                round(upper_cut/1000), " մլն. դրամ"),
      TRUE ~ paste0(lower_cut, "-ից մինչև ", upper_cut, " հազար դրամ")
    )
  ) |> 
  arrange(lower_cut) |> 
  mutate(
    label = fct_inorder(label),
    label = fct_rev(label),
    pct_text = ifelse(pct <= 0.01, NA, percent(pct, accuracy = 0.1))
  ) |> 
  ungroup() |> 
  ggplot(aes(year, pct, fill = label, label = pct_text)) +
  geom_col(alpha = 0.8) +
  geom_text(position = position_stack(vjust = .5)) +
  scale_x_continuous(breaks = seq(2005, 2022, 1)) +
  scale_y_continuous(labels = percent_format()) +
  # scale_fill_brewer(type = "div", palette = 1, direction = -1) +
  scale_fill_manual(values = colfunc(9)) +
  labs(
    x = NULL,
    y = NULL,
    fill = NULL,
    title = "Որքա՞ն է Հայաստանի ընտանիքների ամսական եկամուտը",
    subtitle = "Տնային տնտեսությունների եկամուտների բաշխվածությունը ըստ տարիների\nԵկամուտնեը ճշգրտվել են 2022 թվականի վերջի գներով և կշռվել",
    caption = paste0(caption_arm, "    |    տվյալների աղբյուր` armstat.am")
  ) +
  theme(
    panel.grid.major.x = element_blank()
  )

```


```{r percentage change 2, include=FALSE}

household_pct_change_plot_2 <-
  household_income_db |> 
  filter(
    year >= 2005,
    totincome != 0,
    !is.na(totincome)
  ) |> 
  select(year, date, marz, totincome, weight) |> 
  left_join(inf_cumprod, join_by(date)) |> 
  mutate(totincome = totincome * adj_price) |> 
  ggplot(aes(
    x = totincome, y = as.factor(year), 
    fill = 0.5 - abs(0.5 - after_stat(ecdf)),
    # weight = weight
  )) +
  stat_density_ridges(
    quantile_lines = TRUE, scale = 3,
    rel_min_height = 0.01,  quantiles = 4, alpha = 0.5,
    geom = "density_ridges_gradient", calc_ecdf = TRUE
  ) +
  scale_x_log10(breaks = 10^(4:6), labels = number_format(), limits = c(10^3.5, 10^6.5)) +
  # scale_fill_viridis_c(name = "Հավանականություն", direction = -1) +
  scale_fill_gradientn(name = "Հավանականություն", colors = rev(colfunc(100))) +
  labs(
    x = "դրամ",
    y = NULL,
    title = "Որքա՞ն է Հայաստանի ընտանիքների ամսական եկամուտը",
    subtitle = "Տնային տնտեսությունների եկամուտների բաշխվածությունը ըստ տարիների\nԵկամուտնեը ճշգրտվել են 2021 թվականի գներով",
     caption = paste0(caption_arm, "    |    տվյալների աղբյուր` armstat.am")
  ) +
  annotation_logticks(base = 10, sides = "b")
```



```{r deciles and age plot, include=FALSE}

decile_year <- 2022

decile_description <- 
  data_37 %>% 
  filter(year == decile_year) %>% 
  summarise(deciles = quantile(totincome, probs = seq(0.1, 0.9, 0.1))) %>% 
  bind_rows(tibble(deciles = NA), .) %>% 
  mutate(
    deciles2 = lead(deciles),
    x = row_number(),
    description = case_when(
      x == 1 ~ paste0("1-ին դեցիլ` ", round(deciles2/1000), " հազար դրամից պակաս"),
      x == 10 ~ paste0("10-րդ դեցիլ` ", round(deciles/1000), " հազար դրամից ավել"),
      TRUE ~ paste0(x, "-րդ դեցիլ` ", round(deciles/1000), "-ից մինչև ", 
                    round(deciles2/1000)," հազար դրամ"),
    ),
    description = fct_inorder(description),
    y = 0
  ) %>% 
  select(description, x, y)

# I am not calculating the wight factor here, should I?

deciles_and_age_plot <- 
  data_37 %>% 
  filter(year == decile_year) %>%
  select(year, marz, members, totincome, contains("_sum")) %>% 
  select(-hheld_over63_sum) %>% 
  mutate(
    hhch_18_62_sum = members - rowSums(across(contains("_sum")), na.rm = TRUE),
    income_bin = ntile(totincome, 10),
    # income_bin = cut(
    #   totincome/1000,
    #   breaks = c(0, 2^(6:10), 1e5),
    #   include.lowest = TRUE,
    #   labels = c("[0, 64]", "(64, 128]", "(128, 256]", 
    #              "(256, 512]", "(512, 1024]", "(1024 & more)")
    # )
  ) %>% 
  group_by(
    year, 
    # marz,
    income_bin
  ) %>% 
  summarise(across(contains("_sum"), ~sum(.x, na.rm = TRUE)), .groups = "drop") %>% 
  pivot_longer(contains("_sum"), names_to = "age_group", values_to = "sum_head_count") %>%
  group_by(
    year, 
    # marz,
    income_bin
  ) %>% 
  mutate(
    age_group = str_remove(age_group, "hhch_|hheld_"),
    age_group = str_remove(age_group, "_sum"),
    age_group = str_replace(age_group, "_", "-"),
    age_group = fct_relevel(age_group, "0-3", "4-5", "6-11", "12-17", "18-62"),
    age_group = fct_rev(age_group),
    pct_head_count = sum_head_count / sum(sum_head_count)
  ) %>%
  ungroup() %>% 
  ggplot() +
  geom_col(aes(income_bin, pct_head_count, fill = age_group)) +
  geom_point(data = decile_description, aes(x, y, color = description)) + # delete cuts
  scale_x_continuous(breaks = 1:10) +   # delete when using cuts
  scale_color_manual(values = rep("#FFFFFF00", 10)) + # delete when using cuts
  scale_y_continuous(labels = percent_format()) +
  scale_fill_manual(values = rev(colfunc(9))) +
  guides(color=guide_legend(nrow=3,byrow=TRUE)) +
  # facet_wrap(~marz) +
  labs(
    x = "եկամտային խումբի դեցիլներ",
    y = NULL,
    fill = "տարիքային խումբ",
    color = "եկամտային խմբի դեցիլներ", # delete when using cuts
    title = paste0("Տնային տնտեսությունների տարիքային և եկամտային խմբարի բաշխվածությունը"),
    # "Դեմոգրաֆիկ ջրբաժանը. Ինչպիսի՞ն է տարիքային և եկամտային բաշխումը հայերի միջև",
    subtitle = "2022թ․",
    caption = "Հեղինակ` Աղասի Թավադյան    |    tvyal.com    |    տվյալների աղբյուր` armstat.am"
  )
  
```


```{r}
data_37
```


```{r, include=FALSE}
# household_22 %>% 
#   transmute(marz = hh_02, weight, members, totincome, hheld_over63_sum, y1_3amd.1.00) |> 
#   mutate(
#     income_bin = ntile(totincome, 10),
#     # income_bin = cut(
#     #   totincome/1000,
#     #   breaks = c(0, 2^(6:10), 1e5),
#     #   include.lowest = TRUE,
#     #   labels = c("[0, 64]", "(64, 128]", "(128, 256]", 
#     #              "(256, 512]", "(512, 1024]", "(1024 & more)")
#     # )
#   ) |> 
#   filter(!is.na(hheld_over63_sum)) |> 
#   mutate(y1_3amd.4.00  = y1_3amd.4.00 / hheld_over63_sum) |> 
#   # group_by(income_bin) |> 
#   summarise(pension = sum(y1_3amd.4.00 * weight, na.rm = TRUE) / sum(weight, na.rm = TRUE)) |> 
#   group_by(
#     year, 
#     # marz,
#     income_bin
#   ) %>% 
#   summarise(across(contains("_sum"), ~sum(.x, na.rm = TRUE)), .groups = "drop") %>% 
#   pivot_longer(contains("_sum"), names_to = "age_group", values_to = "sum_head_count") %>%
#   group_by(
#     year, 
#     # marz,
#     income_bin
#   )
```



```{r household income by types, include=FALSE}
household_22 <- 
  rio::import("https://www.armstat.am/file/doc/99543018.xlsx") |> 
  as_tibble()


household_22_income_cuts <- 
  household_22 |> 
  reframe(
    totincome = wtd.quantile(totincome, weight, probs = seq(0, 1, 0.1))
  ) |> 
  pull(totincome)

income_type_dict <- 
  tibble(
    name = c(
      "y1_3amd.1.00", "y1_3amd.2.00", "y1_3amd.4.00", "y1_3amd.6.00",
      "y1_3amd.8.00", "y1_3amd.9.00", "y1_3amd.10.00", "y1_3amd.12.00",
      "y1_3amd.13.00", "y1_3amd.14.00", "y1_3amd.15.00", "y1_3amd.17.00",
      "y1_3amd.18.00", "y1_3amd.19.00", "y1_3amd.23.00", "y1_3amd.26.00", "y1_3amd.28.00"
    ),
    name_desc = c(
      "income from salary, including in kind payment of household per month in dram",
      "income from self employment",
      "income from pension",
      "income from family benefit",
      "Income from one-off benefit for child birth",
      "income from benefit given for care of a child under 2 years old",
      "income from other benefit for the child",
      "income from other benefits",
      "income from stipendium",
      "income from sale of real estate (flat, cottage, land)",
      "income from sale of the valuables (car, jewelry, furniture)",
      "income from property (rent, interests, dividend)",
      "income from money received from relatives, living in Armenia",
      "income from money received from relatives, living out of Armenia",
      "income from sale of securities",
      "income from pension from other country",
      "other income"
    ),
    name_desc_arm = c(
      "աշխատավարձից",
       "ինքնազբաղվածությունից",
       "կենսաթոշակից",
       "ընտանեկան նպաստից",
       "ծննդյան միանվագ նպաստից եկամուտ",
       "մինչև 2 տարեկան երեխայի խնամքի համար տրվող նպաստից",
       "երեխայի համար այլ նպաստից",
       "այլ նպաստներից",
       "կրթաթոշակից",
       "անշարժ գույքի վաճառքից",
       "թանկարժեք իրերի վաճառքից",
       "վարձավճար, տոկոսներ, շահաբաժիններ",
       "Հայաստանում բնակվող հարազատներից ստացված գումարներ",
       "Հայաստանից դուրս ապրող հարազատներից ստացված գումարներ",
       "արժեթղթերի վաճառքից",
       "այլ երկրի կենսաթոշակից",
       "այլ եկամուտներ"
    )
  )

income_data <- 
  household_22 |> 
  mutate(
     deciles = cut(
      totincome,
      breaks = household_22_income_cuts,
      labels = 1:10,
      include.lowest = TRUE
    )
  ) |> 
  select(deciles, weight, contains("y1_3amd")) |> 
  mutate(
    across(-c(deciles, weight), ~ifelse(is.na(.x), 0, .x))
  ) |> 
  group_by(deciles) |> 
  reframe(
    across(-weight, ~sum(.x * weight) / sum(weight))
  ) |> 
  ungroup() |> 
  pivot_longer(-deciles) |> 
  mutate(
    name = fct_lump_n(name, n = 6, w = value,  other_level = "y1_3amd.28.00")
  ) |> 
  group_by(deciles, name) |> 
  summarise(
    value = sum(value)
  ) |> 
  ungroup() |> 
  left_join(income_type_dict, join_by(name)) |> 
  group_by(deciles) |> 
  mutate(
    pct = value / sum(value),
    pct_text = ifelse(pct < 0.01, NA, percent(pct, accuracy = 0.1)),
    value_text = ifelse(value < 7e3, NA, number(value / 1000, accuracy = 1)),
    name_number = str_replace(name, "y1_3amd.(\\d+).00", "\\1"),
    name_number = as.integer(name_number)
  ) |> 
  ungroup() |> 
  arrange(name_number) |> 
  mutate(
    name_desc = fct_inorder(name_desc),
    name_desc_arm = fct_inorder(name_desc_arm)
  )

income_deciles_drams <- 
  income_data |> 
  ggplot(aes(deciles, value / 1000, fill = name_desc_arm, label = value_text)) +
  geom_col() +
  geom_text(position = position_stack(vjust = .5)) +
  scale_fill_manual(values = colfunc3(7)) +
  scale_y_continuous(breaks = seq(0, 1000, 100), labels = number_format()) +
  guides(fill=guide_legend(nrow=4,byrow=TRUE)) +
  theme( panel.grid.major = element_blank()) +
  labs(
    x = "եկամտային խումբի դեցիլներ",
    y = NULL,
    fill = "Եկամտ`",
    color = "եկամտային խմբի դեցիլներ", # delete when using cuts
    title = paste0("Դեցիլային խմբերի եկամտի գոյացման աղբյուրները ",
                   decile_year ,"թ.-ին"),
    subtitle = "Հազար դրամ",
    caption = "Հեղինակ` Աղասի Թավադյան    |    tvyal.com    |    տվյալների աղբյուր` armstat.am"
  )

income_deciles_pct <- 
  income_data |> 
  ggplot(aes(deciles, pct, fill = name_desc_arm, label = pct_text)) +
  geom_col() +
  geom_text(position = position_stack(vjust = .5)) +
    scale_fill_manual(values = colfunc3(7)) +
  scale_y_continuous(breaks = seq(0, 1, 0.25), labels = percent_format()) +
  guides(fill=guide_legend(nrow=4,byrow=TRUE)) +
  theme( panel.grid.major = element_blank()) +
  labs(
    x = "եկամտային խումբի դեցիլներ",
    y = NULL,
    fill = "Եկամտ`",
    color = "եկամտային խմբի դեցիլներ", # delete when using cuts
    title = paste0("Դեցիլային խմբերի եկամտի գոյացման աղբյուրները ",
                   decile_year ,"թ.-ին"),
    subtitle = "տոկոս",
    caption = "Հեղինակ` Աղասի Թավադյան    |    tvyal.com    |    տվյալների աղբյուր` armstat.am"
  )






  
  
```




Նշենք, որ այս վերլուծության տվյալները վերցված են պաշտոնական աղբյուրներից, մասնավորապես՝ [տնային տնտեսությունների կենսամակարդակի (կենսապայմանների) ամբողջացված հետազոտության անվանազերծված միկրոտվյալների բազա (ըստ տնային տնտեսությունների)](https://www.armstat.am/en/?nid=205) և [Հայաստանի սպառողական գների ամսական ինդեքսը](https://www.cba.am/stat/stat_data_arm/6_CPI_arm.xls): Տնային տնտեսությունների կենսամակարդակի ցուցանիշները ճշգրտվել են ամսական կումուլատիվ գնաճով, այսինքն յուրաքանչյուր ցուցանիշ ներկայացնում է 2022 թվականի վերջի գնողունակությունը։ Ցուցանիշները նաև կշռվել են։ Հաշվարկները կարելի է ստուգել այցելելով [github-ի](https://github.com/tavad/tvyal_newsletter/2024) մեր էջը, որտեղ տրված են տվյալները, հաշվարկների և գծապատկերների կոդը։ 

2022-ին գրանցվել է 12.6 տոկոս տնտեսական աճ, մեկ շնչին ընկնող ՀՆԱ-ն աճել է 4 972 դոլարից մինչև 7 018 դոլար, այսինքն 41 տոկոսով, սակայն ժողովրդի իրակական եկամուտները ընկել են։

2021-ին տնային տնտեսությունների միջին ճշգրտված եկամուտը կազմել էր 333 հազար դրամ, իսկ 2022-ին՝ 320 հազար դրամ։ Բնակչության ամենաաղքատ 10% շեմը ստանում էր մինչև 101 հազար դրամ 2021 թվականին, իսկ 2022-ին՝ արդեն 88 հազար դրամ:

Առաջին գծապատկերում տողերը ներկայացնում են մարզերը, իսկ սյուները հասարակության խավերը (անապահով խավ, միջին խավ և հարուստներ)։ Եթե գիծը կարմիր է, ապա նախորդ տարվա համեմատ եկամուտները պակասել են, եթե կապույտ ապա՝ աճել։

**Գծապատկեր 1.** Տնային տնտեսությունների համախառն եկամուտների փոփոխությունը ըստ մարզերի

```{r, echo=FALSE, warning=FALSE, fig.width = 12, fig.height = 6}
household_change_in_2_years_plot
```

Տնային տնտեսությունների եկամուտները 2022 թվականին պակասել են բոլոր մարզերում բացի Կոտայքի, Գեղարքունիքի և Տավուշի մարզերից։

Երևանում և Արագածոտնում 2022 թվականին հարուստները ավելի են հարստացել, իսկ աղքատները ավելի են աղքատացնել։

Մնացած մարզերում, ինչպես նաև ամբողջ Հայաստանի համար, բոլոր խավերի եկամուտները համեմատած 2021 թվականի հետ պակասել են։

Դիտարկենք տնային տնտեսությունների եկամուտների փոփոխությունը 2018 թվականից սկսած։ Ինչպես երևում է գնաճով ճշգրտված եկամուտները Հայաստանի համար ամենաբարձր կետում էին 2020 թվականին, միջին վիճակագրական ընտանիքը ստանում էր ամսական 278 հազար դրամ (2022 տարեվերջի գներով): Երկու տարվա ընթացքում միջին ընտանիքի եկամուտը ընկել է 15 հազար դրամով՝ մինչև 263 հազար դրամ։ Երևանում միջին ընտանիքի եկամտաբերությունը չի փոխվել այս 2 տարիների ընթացքում, այն հիմականում ընկել է մարզերում։ Նշված 2 տարիների ընթացքում եկամուտի աճ են գրանցել Երևանի հարուստ խաղվի ներկայացուցչները (9-րդ դեցիլ), որոնց ընտանեկան իրական եկամուտի շեմը բարձրացել է 629 հազարից 2022 թվականին մինչև 671 հազար դրամ։

**Գծապատկեր 2.** Հայաստանի տնային տնտեսությունների եկամուտների փոփոխությունը 2018-ից 2022 թվականներին

```{r, echo=FALSE, warning=FALSE, fig.width = 12, fig.height = 8}
household_change_18_22_plot
```

Հաջորդ գծապատկերը համեմատում է գնաճով ճշգրտված տնային տնտեսությունների տարեկան եկամուտները 2005 թվականից սկսած։ Եկամուտները բաժանվել են աճողական զամբյուղների։ 

**Գծապատկեր 3.** Որքա՞ն է Հայաստանի ընտանիքների ամսական եկամուտը

```{r, echo=FALSE, warning=FALSE, fig.width = 12, fig.height = 8}
household_pct_change_plot
```


Ինչպես երևում է գծապատկերից մինչև 128 հազար դրամ ստացողները 3.5 տոկոսային կետով աճել են համեմատած 2021-ի։ 128-256 հազար դրամ ստացողների թիվը կրճատվել է 1.9 տոկոսային կետով։

Տվյալները առկա են 2005 թվականից։ Գծապատկերից նաև երևում է որ 2005 թվականից տնային տնտեսություններ գնաճով ճշգրտված եկամուտները գրանցել են կայուն աճ։ Ըստ տվյալների տնային տնտեսությունների իրական եկամուտները ամենամեծ աճն են արձանագրել 2006 և 2007, ինչպես նաև 2019 թվականին։

Անվանական եկամուտների աճ գրանցվել է նաև 2021 և 2022 թվականներին, սակայն այդ տարիներին գրանցվել է համապատասխանաբար 7.2 և 8.6 տոկոս գնաճ, որը զգալի իջեցրել է իրական եկամուտները։ Սա նշանակում է որ 2022 թվականի վերջին աշխատավարձերը դեռ չեն հասել գնաճի տեմպին և 2022 թվականին գրանցված 12.6 տոկոս տնտեսական աճը դեռ չի անդրադարձել տնային տնտեսությունների եկամուտների կամ աշխատավարձերի աճի վրա։ Նշեմ որ 2023 թվականի վերջին գրանցվել է գրեթե զրոյական գնաճ։ Զրոյական գնաճի տեսակետը ներկայացված է [տեսանյութում](https://youtu.be/Va5q9efWaI4)։

Երրորդ գծապատկերում ներկայացված միտքը այլընտրանքային կերպով արտացոլում է նաև հաջորդ գծապատկերը։

**Գծապատկեր 4.** Որքա՞ն է Հայաստանի ընտանիքների ամսական եկամուտը, այլընտրանքային հայացք

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 12, fig.height = 8}
household_pct_change_plot_2
```

Այղուսակի տեսքով ներկայացնենք նաև տնային տնտեսությունների եկամուտների փոփոխությունը տարիների ընթացքում։


```{r, echo=FALSE, fig.width = 6}
income_table
```

ԴԻտարկենք նաև տնային տնտեսությունների եկամուտները ըստ դեցիլային խմբարի և այդ խմբերում սեռատարիքային կազմի։

Ինչպես երևում է գծապատկերում ինչքան տնային տնտեսությունը ավելի քիչ է ստանում եկամուտ, այնքան ավելի մեծ է հավանականությունը որ այդ տնային տնտեսությունում տարեցների քանակությունը ավելի մեծ կլինի։ Այսպես 123 հազար դրամից ցածր եկամուտ ստացող տնային տնտեսություններում 1/3-ը 63 և ավել տարիք ունեցող քաղաքացիներ են։ Այսպես այս խմբի վրա ավելի շատ են ընկնում առողջապահական ծախսերը:

**Գծապատկեր 5.** Տնային տնտեսությունների և տարիքային խմբարի բաշխվածությունը
```{r, echo=FALSE, warning=FALSE, fig.width = 12, fig.height = 8}
deciles_and_age_plot
```

Ինչպես երևում է մինչև 123 հազար դրամ ստացող առաջին և երկրորդ դեցիլի համար հիմնական եկամուտը գոյանում է եկնսաթոշակից։

**Գծապատկեր 6.** Դեցիլային խմբերի եկամտների աղբյուրները, դրամ
```{r, echo=FALSE, warning=FALSE, fig.width = 12, fig.height = 8}
income_deciles_drams
```


**Գծապատկեր 7.** Որքա՞ն է Հայաստանի ընտանիքների ամսական եկամուտը, այլընտրանքային հայացք
```{r, echo=FALSE, warning=FALSE, fig.width = 12, fig.height = 8}
income_deciles_pct
```




Հարգանքներով,            
Աղասի Թավադյան         
07.01.2024          
[tvyal.com](https://www.tvyal.com/)      
[tavadyan.com](https://www.tavadyan.com/)





